ERROR:root:Build interruption occurred. Cleaning console.
ERROR:root:make[2]: *** [/home/amd/linux/Makefile:1250: include/config/kernel.release] Interrupt
make[1]: *** [/home/amd/linux/Makefile:248: __sub-make] Interrupt
make: *** [Makefile:248: __sub-make] Interrupt

[20:25:01] Configuring KUnit Kernel ...
[20:25:01] Building KUnit Kernel ...
Populating config with:
$ make ARCH=x86_64 O=.kunit olddefconfig
Building with:
$ make all compile_commands.json scripts_gdb ARCH=x86_64 O=.kunit --jobs=4
ERROR:root:make[5]: Warning: File 'drivers/pinctrl/.amd_pinconf_set_kunit_test.o.cmd' has modification time 7477 s in the future
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:12:38: warning: ‘struct gpio_chip’ declared inside parameter list will not be visible outside of this definition or declaration
   12 | static int amd_gpio_set_value(struct gpio_chip *gc, unsigned int offset, int value)
      |                                      ^~~~~~~~~
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c: In function ‘amd_gpio_set_value’:
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:16:37: error: implicit declaration of function ‘gpiochip_get_data’ [-Werror=implicit-function-declaration]
   16 |         struct amd_gpio *gpio_dev = gpiochip_get_data(gc);
      |                                     ^~~~~~~~~~~~~~~~~
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:16:37: warning: initialization of ‘struct amd_gpio *’ from ‘int’ makes pointer from integer without a cast [-Wint-conversion]
In file included from ../include/linux/spinlock.h:314,
                 from ../include/linux/kref.h:16,
                 from ../include/kunit/test.h:22,
                 from ../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:1:
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:18:40: error: invalid use of undefined type ‘struct amd_gpio’
   18 |         raw_spin_lock_irqsave(&gpio_dev->lock, flags);
      |                                        ^~
../include/linux/spinlock_api_up.h:28:32: note: in definition of macro ‘___LOCK’
   28 |   do { __acquire(lock); (void)(lock); } while (0)
      |                                ^~~~
../include/linux/spinlock_api_up.h:40:31: note: in expansion of macro ‘__LOCK’
   40 |   do { local_irq_save(flags); __LOCK(lock); } while (0)
      |                               ^~~~~~
../include/linux/spinlock_api_up.h:69:49: note: in expansion of macro ‘__LOCK_IRQSAVE’
   69 | #define _raw_spin_lock_irqsave(lock, flags)     __LOCK_IRQSAVE(lock, flags)
      |                                                 ^~~~~~~~~~~~~~
../include/linux/spinlock.h:266:17: note: in expansion of macro ‘_raw_spin_lock_irqsave’
  266 |                 _raw_spin_lock_irqsave(lock, flags);    \
      |                 ^~~~~~~~~~~~~~~~~~~~~~
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:18:9: note: in expansion of macro ‘raw_spin_lock_irqsave’
   18 |         raw_spin_lock_irqsave(&gpio_dev->lock, flags);
      |         ^~~~~~~~~~~~~~~~~~~~~
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:19:33: error: invalid use of undefined type ‘struct amd_gpio’
   19 |         pin_reg = readl(gpio_dev->base + offset * 4);
      |                                 ^~
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:24:33: error: invalid use of undefined type ‘struct amd_gpio’
   24 |         writel(pin_reg, gpio_dev->base + offset * 4);
      |                                 ^~
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:25:45: error: invalid use of undefined type ‘struct amd_gpio’
   25 |         raw_spin_unlock_irqrestore(&gpio_dev->lock, flags);
      |                                             ^~
../include/linux/spinlock_api_up.h:43:32: note: in definition of macro ‘___UNLOCK’
   43 |   do { __release(lock); (void)(lock); } while (0)
      |                                ^~~~
../include/linux/spinlock_api_up.h:56:34: note: in expansion of macro ‘__UNLOCK’
   56 |   do { local_irq_restore(flags); __UNLOCK(lock); } while (0)
      |                                  ^~~~~~~~
../include/linux/spinlock_api_up.h:86:41: note: in expansion of macro ‘__UNLOCK_IRQRESTORE’
   86 |                                         __UNLOCK_IRQRESTORE(lock, flags)
      |                                         ^~~~~~~~~~~~~~~~~~~
../include/linux/spinlock.h:282:17: note: in expansion of macro ‘_raw_spin_unlock_irqrestore’
  282 |                 _raw_spin_unlock_irqrestore(lock, flags);       \
      |                 ^~~~~~~~~~~~~~~~~~~~~~~~~~~
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:25:9: note: in expansion of macro ‘raw_spin_unlock_irqrestore’
   25 |         raw_spin_unlock_irqrestore(&gpio_dev->lock, flags);
      |         ^~~~~~~~~~~~~~~~~~~~~~~~~~
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c: In function ‘test_amd_gpio_set_value_high’:
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:37:40: error: invalid application of ‘sizeof’ to incomplete type ‘struct gpio_chip’
   37 |         gc = kunit_kzalloc(test, sizeof(*gc), GFP_KERNEL);
      |                                        ^
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:38:11: error: invalid use of undefined type ‘struct gpio_chip’
   38 |         gc->base = test_mmio_buffer;
      |           ^~
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:39:17: error: invalid use of undefined type ‘struct amd_gpio’
   39 |         gpio_dev.base = gc->base;
      |                 ^
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:39:27: error: invalid use of undefined type ‘struct gpio_chip’
   39 |         gpio_dev.base = gc->base;
      |                           ^~
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:40:17: error: invalid use of undefined type ‘struct amd_gpio’
   40 |         gpio_dev.lock = __RAW_SPIN_LOCK_UNLOCKED(gpio_dev.lock);
      |                 ^
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:41:29: error: invalid use of undefined type ‘struct amd_gpio’
   41 |         writel(0x0, gpio_dev.base + offset * 4);
      |                             ^
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:42:28: error: passing argument 1 of ‘amd_gpio_set_value’ from incompatible pointer type [-Werror=incompatible-pointer-types]
   42 |         amd_gpio_set_value(gc, offset, value);
      |                            ^~
      |                            |
      |                            struct gpio_chip *
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:12:49: note: expected ‘struct gpio_chip *’ but argument is of type ‘struct gpio_chip *’
   12 | static int amd_gpio_set_value(struct gpio_chip *gc, unsigned int offset, int value)
      |                               ~~~~~~~~~~~~~~~~~~^~
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:43:32: error: invalid use of undefined type ‘struct amd_gpio’
   43 |         result = readl(gpio_dev.base + offset * 4);
      |                                ^
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c: In function ‘test_amd_gpio_set_value_low’:
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:54:40: error: invalid application of ‘sizeof’ to incomplete type ‘struct gpio_chip’
   54 |         gc = kunit_kzalloc(test, sizeof(*gc), GFP_KERNEL);
      |                                        ^
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:55:11: error: invalid use of undefined type ‘struct gpio_chip’
   55 |         gc->base = test_mmio_buffer;
      |           ^~
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:56:17: error: invalid use of undefined type ‘struct amd_gpio’
   56 |         gpio_dev.base = gc->base;
      |                 ^
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:56:27: error: invalid use of undefined type ‘struct gpio_chip’
   56 |         gpio_dev.base = gc->base;
      |                           ^~
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:57:17: error: invalid use of undefined type ‘struct amd_gpio’
   57 |         gpio_dev.lock = __RAW_SPIN_LOCK_UNLOCKED(gpio_dev.lock);
      |                 ^
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:58:47: error: invalid use of undefined type ‘struct amd_gpio’
   58 |         writel(BIT(OUTPUT_VALUE_OFF), gpio_dev.base + offset * 4);
      |                                               ^
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:59:28: error: passing argument 1 of ‘amd_gpio_set_value’ from incompatible pointer type [-Werror=incompatible-pointer-types]
   59 |         amd_gpio_set_value(gc, offset, value);
      |                            ^~
      |                            |
      |                            struct gpio_chip *
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:12:49: note: expected ‘struct gpio_chip *’ but argument is of type ‘struct gpio_chip *’
   12 | static int amd_gpio_set_value(struct gpio_chip *gc, unsigned int offset, int value)
      |                               ~~~~~~~~~~~~~~~~~~^~
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:60:32: error: invalid use of undefined type ‘struct amd_gpio’
   60 |         result = readl(gpio_dev.base + offset * 4);
      |                                ^
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c: In function ‘test_amd_gpio_set_value_zero_offset’:
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:71:40: error: invalid application of ‘sizeof’ to incomplete type ‘struct gpio_chip’
   71 |         gc = kunit_kzalloc(test, sizeof(*gc), GFP_KERNEL);
      |                                        ^
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:72:11: error: invalid use of undefined type ‘struct gpio_chip’
   72 |         gc->base = test_mmio_buffer;
      |           ^~
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:73:17: error: invalid use of undefined type ‘struct amd_gpio’
   73 |         gpio_dev.base = gc->base;
      |                 ^
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:73:27: error: invalid use of undefined type ‘struct gpio_chip’
   73 |         gpio_dev.base = gc->base;
      |                           ^~
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:74:17: error: invalid use of undefined type ‘struct amd_gpio’
   74 |         gpio_dev.lock = __RAW_SPIN_LOCK_UNLOCKED(gpio_dev.lock);
      |                 ^
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:75:29: error: invalid use of undefined type ‘struct amd_gpio’
   75 |         writel(0x0, gpio_dev.base + offset * 4);
      |                             ^
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:76:28: error: passing argument 1 of ‘amd_gpio_set_value’ from incompatible pointer type [-Werror=incompatible-pointer-types]
   76 |         amd_gpio_set_value(gc, offset, value);
      |                            ^~
      |                            |
      |                            struct gpio_chip *
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:12:49: note: expected ‘struct gpio_chip *’ but argument is of type ‘struct gpio_chip *’
   12 | static int amd_gpio_set_value(struct gpio_chip *gc, unsigned int offset, int value)
      |                               ~~~~~~~~~~~~~~~~~~^~
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:77:32: error: invalid use of undefined type ‘struct amd_gpio’
   77 |         result = readl(gpio_dev.base + offset * 4);
      |                                ^
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c: In function ‘test_amd_gpio_set_value_max_offset’:
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:88:40: error: invalid application of ‘sizeof’ to incomplete type ‘struct gpio_chip’
   88 |         gc = kunit_kzalloc(test, sizeof(*gc), GFP_KERNEL);
      |                                        ^
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:89:11: error: invalid use of undefined type ‘struct gpio_chip’
   89 |         gc->base = test_mmio_buffer;
      |           ^~
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:90:17: error: invalid use of undefined type ‘struct amd_gpio’
   90 |         gpio_dev.base = gc->base;
      |                 ^
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:90:27: error: invalid use of undefined type ‘struct gpio_chip’
   90 |         gpio_dev.base = gc->base;
      |                           ^~
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:91:17: error: invalid use of undefined type ‘struct amd_gpio’
   91 |         gpio_dev.lock = __RAW_SPIN_LOCK_UNLOCKED(gpio_dev.lock);
      |                 ^
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:92:29: error: invalid use of undefined type ‘struct amd_gpio’
   92 |         writel(0x0, gpio_dev.base + offset * 4);
      |                             ^
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:93:28: error: passing argument 1 of ‘amd_gpio_set_value’ from incompatible pointer type [-Werror=incompatible-pointer-types]
   93 |         amd_gpio_set_value(gc, offset, value);
      |                            ^~
      |                            |
      |                            struct gpio_chip *
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:12:49: note: expected ‘struct gpio_chip *’ but argument is of type ‘struct gpio_chip *’
   12 | static int amd_gpio_set_value(struct gpio_chip *gc, unsigned int offset, int value)
      |                               ~~~~~~~~~~~~~~~~~~^~
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:94:32: error: invalid use of undefined type ‘struct amd_gpio’
   94 |         result = readl(gpio_dev.base + offset * 4);
      |                                ^
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c: In function ‘test_amd_gpio_set_value_already_set’:
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:105:40: error: invalid application of ‘sizeof’ to incomplete type ‘struct gpio_chip’
  105 |         gc = kunit_kzalloc(test, sizeof(*gc), GFP_KERNEL);
      |                                        ^
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:106:11: error: invalid use of undefined type ‘struct gpio_chip’
  106 |         gc->base = test_mmio_buffer;
      |           ^~
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:107:17: error: invalid use of undefined type ‘struct amd_gpio’
  107 |         gpio_dev.base = gc->base;
      |                 ^
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:107:27: error: invalid use of undefined type ‘struct gpio_chip’
  107 |         gpio_dev.base = gc->base;
      |                           ^~
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:108:17: error: invalid use of undefined type ‘struct amd_gpio’
  108 |         gpio_dev.lock = __RAW_SPIN_LOCK_UNLOCKED(gpio_dev.lock);
      |                 ^
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:109:47: error: invalid use of undefined type ‘struct amd_gpio’
  109 |         writel(BIT(OUTPUT_VALUE_OFF), gpio_dev.base + offset * 4);
      |                                               ^
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:110:28: error: passing argument 1 of ‘amd_gpio_set_value’ from incompatible pointer type [-Werror=incompatible-pointer-types]
  110 |         amd_gpio_set_value(gc, offset, value);
      |                            ^~
      |                            |
      |                            struct gpio_chip *
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:12:49: note: expected ‘struct gpio_chip *’ but argument is of type ‘struct gpio_chip *’
   12 | static int amd_gpio_set_value(struct gpio_chip *gc, unsigned int offset, int value)
      |                               ~~~~~~~~~~~~~~~~~~^~
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:111:32: error: invalid use of undefined type ‘struct amd_gpio’
  111 |         result = readl(gpio_dev.base + offset * 4);
      |                                ^
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c: In function ‘test_amd_gpio_set_value_already_clear’:
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:122:40: error: invalid application of ‘sizeof’ to incomplete type ‘struct gpio_chip’
  122 |         gc = kunit_kzalloc(test, sizeof(*gc), GFP_KERNEL);
      |                                        ^
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:123:11: error: invalid use of undefined type ‘struct gpio_chip’
  123 |         gc->base = test_mmio_buffer;
      |           ^~
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:124:17: error: invalid use of undefined type ‘struct amd_gpio’
  124 |         gpio_dev.base = gc->base;
      |                 ^
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:124:27: error: invalid use of undefined type ‘struct gpio_chip’
  124 |         gpio_dev.base = gc->base;
      |                           ^~
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:125:17: error: invalid use of undefined type ‘struct amd_gpio’
  125 |         gpio_dev.lock = __RAW_SPIN_LOCK_UNLOCKED(gpio_dev.lock);
      |                 ^
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:126:29: error: invalid use of undefined type ‘struct amd_gpio’
  126 |         writel(0x0, gpio_dev.base + offset * 4);
      |                             ^
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:127:28: error: passing argument 1 of ‘amd_gpio_set_value’ from incompatible pointer type [-Werror=incompatible-pointer-types]
  127 |         amd_gpio_set_value(gc, offset, value);
      |                            ^~
      |                            |
      |                            struct gpio_chip *
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:12:49: note: expected ‘struct gpio_chip *’ but argument is of type ‘struct gpio_chip *’
   12 | static int amd_gpio_set_value(struct gpio_chip *gc, unsigned int offset, int value)
      |                               ~~~~~~~~~~~~~~~~~~^~
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:128:32: error: invalid use of undefined type ‘struct amd_gpio’
  128 |         result = readl(gpio_dev.base + offset * 4);
      |                                ^
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c: At top level:
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:9:24: error: storage size of ‘gpio_dev’ isn’t known
    9 | static struct amd_gpio gpio_dev;
      |                        ^~~~~~~~
cc1: some warnings being treated as errors
make[5]: *** [../scripts/Makefile.build:287: drivers/pinctrl/amd_gpio_set_value_kunit_test.o] Error 1
make[5]: *** Waiting for unfinished jobs....
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:12:42: warning: ‘struct gpio_chip’ declared inside parameter list will not be visible outside of this definition or declaration
   12 | static int amd_gpio_get_direction(struct gpio_chip *gc, unsigned offset)
      |                                          ^~~~~~~~~
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c: In function ‘amd_gpio_get_direction’:
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:16:37: error: implicit declaration of function ‘gpiochip_get_data’ [-Werror=implicit-function-declaration]
   16 |         struct amd_gpio *gpio_dev = gpiochip_get_data(gc);
      |                                     ^~~~~~~~~~~~~~~~~
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:16:37: warning: initialization of ‘struct amd_gpio *’ from ‘int’ makes pointer from integer without a cast [-Wint-conversion]
In file included from ../include/linux/spinlock.h:314,
                 from ../include/linux/kref.h:16,
                 from ../include/kunit/test.h:22,
                 from ../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:1:
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:18:40: error: invalid use of undefined type ‘struct amd_gpio’
   18 |         raw_spin_lock_irqsave(&gpio_dev->lock, flags);
      |                                        ^~
../include/linux/spinlock_api_up.h:28:32: note: in definition of macro ‘___LOCK’
   28 |   do { __acquire(lock); (void)(lock); } while (0)
      |                                ^~~~
../include/linux/spinlock_api_up.h:40:31: note: in expansion of macro ‘__LOCK’
   40 |   do { local_irq_save(flags); __LOCK(lock); } while (0)
      |                               ^~~~~~
../include/linux/spinlock_api_up.h:69:49: note: in expansion of macro ‘__LOCK_IRQSAVE’
   69 | #define _raw_spin_lock_irqsave(lock, flags)     __LOCK_IRQSAVE(lock, flags)
      |                                                 ^~~~~~~~~~~~~~
../include/linux/spinlock.h:266:17: note: in expansion of macro ‘_raw_spin_lock_irqsave’
  266 |                 _raw_spin_lock_irqsave(lock, flags);    \
      |                 ^~~~~~~~~~~~~~~~~~~~~~
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:18:9: note: in expansion of macro ‘raw_spin_lock_irqsave’
   18 |         raw_spin_lock_irqsave(&gpio_dev->lock, flags);
      |         ^~~~~~~~~~~~~~~~~~~~~
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:19:33: error: invalid use of undefined type ‘struct amd_gpio’
   19 |         pin_reg = readl(gpio_dev->base + offset * 4);
      |                                 ^~
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:20:45: error: invalid use of undefined type ‘struct amd_gpio’
   20 |         raw_spin_unlock_irqrestore(&gpio_dev->lock, flags);
      |                                             ^~
../include/linux/spinlock_api_up.h:43:32: note: in definition of macro ‘___UNLOCK’
   43 |   do { __release(lock); (void)(lock); } while (0)
      |                                ^~~~
../include/linux/spinlock_api_up.h:56:34: note: in expansion of macro ‘__UNLOCK’
   56 |   do { local_irq_restore(flags); __UNLOCK(lock); } while (0)
      |                                  ^~~~~~~~
../include/linux/spinlock_api_up.h:86:41: note: in expansion of macro ‘__UNLOCK_IRQRESTORE’
   86 |                                         __UNLOCK_IRQRESTORE(lock, flags)
      |                                         ^~~~~~~~~~~~~~~~~~~
../include/linux/spinlock.h:282:17: note: in expansion of macro ‘_raw_spin_unlock_irqrestore’
  282 |                 _raw_spin_unlock_irqrestore(lock, flags);       \
      |                 ^~~~~~~~~~~~~~~~~~~~~~~~~~~
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:20:9: note: in expansion of macro ‘raw_spin_unlock_irqrestore’
   20 |         raw_spin_unlock_irqrestore(&gpio_dev->lock, flags);
      |         ^~~~~~~~~~~~~~~~~~~~~~~~~~
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:23:24: error: ‘GPIO_LINE_DIRECTION_OUT’ undeclared (first use in this function)
   23 |                 return GPIO_LINE_DIRECTION_OUT;
      |                        ^~~~~~~~~~~~~~~~~~~~~~~
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:23:24: note: each undeclared identifier is reported only once for each function it appears in
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:25:16: error: ‘GPIO_LINE_DIRECTION_IN’ undeclared (first use in this function)
   25 |         return GPIO_LINE_DIRECTION_IN;
      |                ^~~~~~~~~~~~~~~~~~~~~~
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c: In function ‘test_amd_gpio_get_direction_output’:
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:34:40: error: invalid application of ‘sizeof’ to incomplete type ‘struct gpio_chip’
   34 |         gc = kunit_kzalloc(test, sizeof(*gc), GFP_KERNEL);
      |                                        ^
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:35:11: error: invalid use of undefined type ‘struct gpio_chip’
   35 |         gc->base = test_mmio_buffer;
      |           ^~
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:36:17: error: invalid use of undefined type ‘struct amd_gpio’
   36 |         gpio_dev.base = gc->base;
      |                 ^
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:36:27: error: invalid use of undefined type ‘struct gpio_chip’
   36 |         gpio_dev.base = gc->base;
      |                           ^~
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:37:17: error: invalid use of undefined type ‘struct amd_gpio’
   37 |         gpio_dev.lock = __RAW_SPIN_LOCK_UNLOCKED(gpio_dev.lock);
      |                 ^
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:38:48: error: invalid use of undefined type ‘struct amd_gpio’
   38 |         writel(BIT(OUTPUT_ENABLE_OFF), gpio_dev.base + offset * 4);
      |                                                ^
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:40:41: error: passing argument 1 of ‘amd_gpio_get_direction’ from incompatible pointer type [-Werror=incompatible-pointer-types]
   40 |         result = amd_gpio_get_direction(gc, offset);
      |                                         ^~
      |                                         |
      |                                         struct gpio_chip *
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:12:53: note: expected ‘struct gpio_chip *’ but argument is of type ‘struct gpio_chip *’
   12 | static int amd_gpio_get_direction(struct gpio_chip *gc, unsigned offset)
      |                                   ~~~~~~~~~~~~~~~~~~^~
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:41:39: error: ‘GPIO_LINE_DIRECTION_OUT’ undeclared (first use in this function)
   41 |         KUNIT_EXPECT_EQ(test, result, GPIO_LINE_DIRECTION_OUT);
      |                                       ^~~~~~~~~~~~~~~~~~~~~~~
../include/kunit/test.h:776:22: note: in definition of macro ‘KUNIT_BASE_BINARY_ASSERTION’
  776 |         const typeof(right) __right = (right);                                 \
      |                      ^~~~~
../include/kunit/test.h:971:9: note: in expansion of macro ‘KUNIT_BINARY_INT_ASSERTION’
  971 |         KUNIT_BINARY_INT_ASSERTION(test,                                       \
      |         ^~~~~~~~~~~~~~~~~~~~~~~~~~
../include/kunit/test.h:968:9: note: in expansion of macro ‘KUNIT_EXPECT_EQ_MSG’
  968 |         KUNIT_EXPECT_EQ_MSG(test, left, right, NULL)
      |         ^~~~~~~~~~~~~~~~~~~
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:41:9: note: in expansion of macro ‘KUNIT_EXPECT_EQ’
   41 |         KUNIT_EXPECT_EQ(test, result, GPIO_LINE_DIRECTION_OUT);
      |         ^~~~~~~~~~~~~~~
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c: In function ‘test_amd_gpio_get_direction_input’:
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:50:40: error: invalid application of ‘sizeof’ to incomplete type ‘struct gpio_chip’
   50 |         gc = kunit_kzalloc(test, sizeof(*gc), GFP_KERNEL);
      |                                        ^
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:51:11: error: invalid use of undefined type ‘struct gpio_chip’
   51 |         gc->base = test_mmio_buffer;
      |           ^~
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:52:17: error: invalid use of undefined type ‘struct amd_gpio’
   52 |         gpio_dev.base = gc->base;
      |                 ^
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:52:27: error: invalid use of undefined type ‘struct gpio_chip’
   52 |         gpio_dev.base = gc->base;
      |                           ^~
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:53:17: error: invalid use of undefined type ‘struct amd_gpio’
   53 |         gpio_dev.lock = __RAW_SPIN_LOCK_UNLOCKED(gpio_dev.lock);
      |                 ^
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:54:29: error: invalid use of undefined type ‘struct amd_gpio’
   54 |         writel(0x0, gpio_dev.base + offset * 4);
      |                             ^
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:56:41: error: passing argument 1 of ‘amd_gpio_get_direction’ from incompatible pointer type [-Werror=incompatible-pointer-types]
   56 |         result = amd_gpio_get_direction(gc, offset);
      |                                         ^~
      |                                         |
      |                                         struct gpio_chip *
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:12:53: note: expected ‘struct gpio_chip *’ but argument is of type ‘struct gpio_chip *’
   12 | static int amd_gpio_get_direction(struct gpio_chip *gc, unsigned offset)
      |                                   ~~~~~~~~~~~~~~~~~~^~
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:57:39: error: ‘GPIO_LINE_DIRECTION_IN’ undeclared (first use in this function)
   57 |         KUNIT_EXPECT_EQ(test, result, GPIO_LINE_DIRECTION_IN);
      |                                       ^~~~~~~~~~~~~~~~~~~~~~
../include/kunit/test.h:776:22: note: in definition of macro ‘KUNIT_BASE_BINARY_ASSERTION’
  776 |         const typeof(right) __right = (right);                                 \
      |                      ^~~~~
../include/kunit/test.h:971:9: note: in expansion of macro ‘KUNIT_BINARY_INT_ASSERTION’
  971 |         KUNIT_BINARY_INT_ASSERTION(test,                                       \
      |         ^~~~~~~~~~~~~~~~~~~~~~~~~~
../include/kunit/test.h:968:9: note: in expansion of macro ‘KUNIT_EXPECT_EQ_MSG’
  968 |         KUNIT_EXPECT_EQ_MSG(test, left, right, NULL)
      |         ^~~~~~~~~~~~~~~~~~~
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:57:9: note: in expansion of macro ‘KUNIT_EXPECT_EQ’
   57 |         KUNIT_EXPECT_EQ(test, result, GPIO_LINE_DIRECTION_IN);
      |         ^~~~~~~~~~~~~~~
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c: In function ‘test_amd_gpio_get_direction_zero_offset’:
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:66:40: error: invalid application of ‘sizeof’ to incomplete type ‘struct gpio_chip’
   66 |         gc = kunit_kzalloc(test, sizeof(*gc), GFP_KERNEL);
      |                                        ^
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:67:11: error: invalid use of undefined type ‘struct gpio_chip’
   67 |         gc->base = test_mmio_buffer;
      |           ^~
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:68:17: error: invalid use of undefined type ‘struct amd_gpio’
   68 |         gpio_dev.base = gc->base;
      |                 ^
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:68:27: error: invalid use of undefined type ‘struct gpio_chip’
   68 |         gpio_dev.base = gc->base;
      |                           ^~
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:69:17: error: invalid use of undefined type ‘struct amd_gpio’
   69 |         gpio_dev.lock = __RAW_SPIN_LOCK_UNLOCKED(gpio_dev.lock);
      |                 ^
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:70:48: error: invalid use of undefined type ‘struct amd_gpio’
   70 |         writel(BIT(OUTPUT_ENABLE_OFF), gpio_dev.base + offset * 4);
      |                                                ^
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:72:41: error: passing argument 1 of ‘amd_gpio_get_direction’ from incompatible pointer type [-Werror=incompatible-pointer-types]
   72 |         result = amd_gpio_get_direction(gc, offset);
      |                                         ^~
      |                                         |
      |                                         struct gpio_chip *
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:12:53: note: expected ‘struct gpio_chip *’ but argument is of type ‘struct gpio_chip *’
   12 | static int amd_gpio_get_direction(struct gpio_chip *gc, unsigned offset)
      |                                   ~~~~~~~~~~~~~~~~~~^~
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:73:39: error: ‘GPIO_LINE_DIRECTION_OUT’ undeclared (first use in this function)
   73 |         KUNIT_EXPECT_EQ(test, result, GPIO_LINE_DIRECTION_OUT);
      |                                       ^~~~~~~~~~~~~~~~~~~~~~~
../include/kunit/test.h:776:22: note: in definition of macro ‘KUNIT_BASE_BINARY_ASSERTION’
  776 |         const typeof(right) __right = (right);                                 \
      |                      ^~~~~
../include/kunit/test.h:971:9: note: in expansion of macro ‘KUNIT_BINARY_INT_ASSERTION’
  971 |         KUNIT_BINARY_INT_ASSERTION(test,                                       \
      |         ^~~~~~~~~~~~~~~~~~~~~~~~~~
../include/kunit/test.h:968:9: note: in expansion of macro ‘KUNIT_EXPECT_EQ_MSG’
  968 |         KUNIT_EXPECT_EQ_MSG(test, left, right, NULL)
      |         ^~~~~~~~~~~~~~~~~~~
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:73:9: note: in expansion of macro ‘KUNIT_EXPECT_EQ’
   73 |         KUNIT_EXPECT_EQ(test, result, GPIO_LINE_DIRECTION_OUT);
      |         ^~~~~~~~~~~~~~~
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c: In function ‘test_amd_gpio_get_direction_max_offset’:
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:82:40: error: invalid application of ‘sizeof’ to incomplete type ‘struct gpio_chip’
   82 |         gc = kunit_kzalloc(test, sizeof(*gc), GFP_KERNEL);
      |                                        ^
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:83:11: error: invalid use of undefined type ‘struct gpio_chip’
   83 |         gc->base = test_mmio_buffer;
      |           ^~
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:84:17: error: invalid use of undefined type ‘struct amd_gpio’
   84 |         gpio_dev.base = gc->base;
      |                 ^
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:84:27: error: invalid use of undefined type ‘struct gpio_chip’
   84 |         gpio_dev.base = gc->base;
      |                           ^~
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:85:17: error: invalid use of undefined type ‘struct amd_gpio’
   85 |         gpio_dev.lock = __RAW_SPIN_LOCK_UNLOCKED(gpio_dev.lock);
      |                 ^
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:86:48: error: invalid use of undefined type ‘struct amd_gpio’
   86 |         writel(BIT(OUTPUT_ENABLE_OFF), gpio_dev.base + offset * 4);
      |                                                ^
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:88:41: error: passing argument 1 of ‘amd_gpio_get_direction’ from incompatible pointer type [-Werror=incompatible-pointer-types]
   88 |         result = amd_gpio_get_direction(gc, offset);
      |                                         ^~
      |                                         |
      |                                         struct gpio_chip *
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:12:53: note: expected ‘struct gpio_chip *’ but argument is of type ‘struct gpio_chip *’
   12 | static int amd_gpio_get_direction(struct gpio_chip *gc, unsigned offset)
      |                                   ~~~~~~~~~~~~~~~~~~^~
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:89:39: error: ‘GPIO_LINE_DIRECTION_OUT’ undeclared (first use in this function)
   89 |         KUNIT_EXPECT_EQ(test, result, GPIO_LINE_DIRECTION_OUT);
      |                                       ^~~~~~~~~~~~~~~~~~~~~~~
../include/kunit/test.h:776:22: note: in definition of macro ‘KUNIT_BASE_BINARY_ASSERTION’
  776 |         const typeof(right) __right = (right);                                 \
      |                      ^~~~~
../include/kunit/test.h:971:9: note: in expansion of macro ‘KUNIT_BINARY_INT_ASSERTION’
  971 |         KUNIT_BINARY_INT_ASSERTION(test,                                       \
      |         ^~~~~~~~~~~~~~~~~~~~~~~~~~
../include/kunit/test.h:968:9: note: in expansion of macro ‘KUNIT_EXPECT_EQ_MSG’
  968 |         KUNIT_EXPECT_EQ_MSG(test, left, right, NULL)
      |         ^~~~~~~~~~~~~~~~~~~
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:89:9: note: in expansion of macro ‘KUNIT_EXPECT_EQ’
   89 |         KUNIT_EXPECT_EQ(test, result, GPIO_LINE_DIRECTION_OUT);
      |         ^~~~~~~~~~~~~~~
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c: At top level:
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:9:24: error: storage size of ‘gpio_dev’ isn’t known
    9 | static struct amd_gpio gpio_dev;
      |                        ^~~~~~~~
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c: In function ‘amd_gpio_get_direction’:
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:26:1: error: control reaches end of non-void function [-Werror=return-type]
   26 | }
      | ^
cc1: some warnings being treated as errors
make[5]: *** [../scripts/Makefile.build:287: drivers/pinctrl/amd_gpio_get_direction_kunit_test.o] Error 1
make[4]: *** [../scripts/Makefile.build:554: drivers/pinctrl] Error 2
make[4]: *** Waiting for unfinished jobs....
make[3]: *** [../scripts/Makefile.build:554: drivers] Error 2
make[3]: *** Waiting for unfinished jobs....
make[2]: *** [/home/amd/linux/Makefile:2003: .] Error 2
make[1]: *** [/home/amd/linux/Makefile:248: __sub-make] Error 2
make: *** [Makefile:248: __sub-make] Error 2

[20:27:19] Configuring KUnit Kernel ...
[20:27:19] Building KUnit Kernel ...
Populating config with:
$ make ARCH=x86_64 O=.kunit olddefconfig
Building with:
$ make all compile_commands.json scripts_gdb ARCH=x86_64 O=.kunit --jobs=4
ERROR:root:make[5]: Warning: File 'drivers/pinctrl/.amd_pinconf_set_kunit_test.o.cmd' has modification time 7413 s in the future
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:12:38: warning: ‘struct gpio_chip’ declared inside parameter list will not be visible outside of this definition or declaration
   12 | static int amd_gpio_set_value(struct gpio_chip *gc, unsigned int offset, int value)
      |                                      ^~~~~~~~~
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c: In function ‘amd_gpio_set_value’:
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:16:37: error: implicit declaration of function ‘gpiochip_get_data’ [-Werror=implicit-function-declaration]
   16 |         struct amd_gpio *gpio_dev = gpiochip_get_data(gc);
      |                                     ^~~~~~~~~~~~~~~~~
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:16:37: warning: initialization of ‘struct amd_gpio *’ from ‘int’ makes pointer from integer without a cast [-Wint-conversion]
In file included from ../include/linux/spinlock.h:314,
                 from ../include/linux/kref.h:16,
                 from ../include/kunit/test.h:22,
                 from ../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:1:
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:18:40: error: invalid use of undefined type ‘struct amd_gpio’
   18 |         raw_spin_lock_irqsave(&gpio_dev->lock, flags);
      |                                        ^~
../include/linux/spinlock_api_up.h:28:32: note: in definition of macro ‘___LOCK’
   28 |   do { __acquire(lock); (void)(lock); } while (0)
      |                                ^~~~
../include/linux/spinlock_api_up.h:40:31: note: in expansion of macro ‘__LOCK’
   40 |   do { local_irq_save(flags); __LOCK(lock); } while (0)
      |                               ^~~~~~
../include/linux/spinlock_api_up.h:69:49: note: in expansion of macro ‘__LOCK_IRQSAVE’
   69 | #define _raw_spin_lock_irqsave(lock, flags)     __LOCK_IRQSAVE(lock, flags)
      |                                                 ^~~~~~~~~~~~~~
../include/linux/spinlock.h:266:17: note: in expansion of macro ‘_raw_spin_lock_irqsave’
  266 |                 _raw_spin_lock_irqsave(lock, flags);    \
      |                 ^~~~~~~~~~~~~~~~~~~~~~
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:18:9: note: in expansion of macro ‘raw_spin_lock_irqsave’
   18 |         raw_spin_lock_irqsave(&gpio_dev->lock, flags);
      |         ^~~~~~~~~~~~~~~~~~~~~
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:19:33: error: invalid use of undefined type ‘struct amd_gpio’
   19 |         pin_reg = readl(gpio_dev->base + offset * 4);
      |                                 ^~
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:24:33: error: invalid use of undefined type ‘struct amd_gpio’
   24 |         writel(pin_reg, gpio_dev->base + offset * 4);
      |                                 ^~
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:25:45: error: invalid use of undefined type ‘struct amd_gpio’
   25 |         raw_spin_unlock_irqrestore(&gpio_dev->lock, flags);
      |                                             ^~
../include/linux/spinlock_api_up.h:43:32: note: in definition of macro ‘___UNLOCK’
   43 |   do { __release(lock); (void)(lock); } while (0)
      |                                ^~~~
../include/linux/spinlock_api_up.h:56:34: note: in expansion of macro ‘__UNLOCK’
   56 |   do { local_irq_restore(flags); __UNLOCK(lock); } while (0)
      |                                  ^~~~~~~~
../include/linux/spinlock_api_up.h:86:41: note: in expansion of macro ‘__UNLOCK_IRQRESTORE’
   86 |                                         __UNLOCK_IRQRESTORE(lock, flags)
      |                                         ^~~~~~~~~~~~~~~~~~~
../include/linux/spinlock.h:282:17: note: in expansion of macro ‘_raw_spin_unlock_irqrestore’
  282 |                 _raw_spin_unlock_irqrestore(lock, flags);       \
      |                 ^~~~~~~~~~~~~~~~~~~~~~~~~~~
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:25:9: note: in expansion of macro ‘raw_spin_unlock_irqrestore’
   25 |         raw_spin_unlock_irqrestore(&gpio_dev->lock, flags);
      |         ^~~~~~~~~~~~~~~~~~~~~~~~~~
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c: In function ‘test_amd_gpio_set_value_high’:
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:37:40: error: invalid application of ‘sizeof’ to incomplete type ‘struct gpio_chip’
   37 |         gc = kunit_kzalloc(test, sizeof(*gc), GFP_KERNEL);
      |                                        ^
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:38:11: error: invalid use of undefined type ‘struct gpio_chip’
   38 |         gc->base = test_mmio_buffer;
      |           ^~
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:39:17: error: invalid use of undefined type ‘struct amd_gpio’
   39 |         gpio_dev.base = gc->base;
      |                 ^
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:39:27: error: invalid use of undefined type ‘struct gpio_chip’
   39 |         gpio_dev.base = gc->base;
      |                           ^~
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:40:17: error: invalid use of undefined type ‘struct amd_gpio’
   40 |         gpio_dev.lock = __RAW_SPIN_LOCK_UNLOCKED(gpio_dev.lock);
      |                 ^
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:41:29: error: invalid use of undefined type ‘struct amd_gpio’
   41 |         writel(0x0, gpio_dev.base + offset * 4);
      |                             ^
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:42:28: error: passing argument 1 of ‘amd_gpio_set_value’ from incompatible pointer type [-Werror=incompatible-pointer-types]
   42 |         amd_gpio_set_value(gc, offset, value);
      |                            ^~
      |                            |
      |                            struct gpio_chip *
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:12:49: note: expected ‘struct gpio_chip *’ but argument is of type ‘struct gpio_chip *’
   12 | static int amd_gpio_set_value(struct gpio_chip *gc, unsigned int offset, int value)
      |                               ~~~~~~~~~~~~~~~~~~^~
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:43:32: error: invalid use of undefined type ‘struct amd_gpio’
   43 |         result = readl(gpio_dev.base + offset * 4);
      |                                ^
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c: In function ‘test_amd_gpio_set_value_low’:
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:54:40: error: invalid application of ‘sizeof’ to incomplete type ‘struct gpio_chip’
   54 |         gc = kunit_kzalloc(test, sizeof(*gc), GFP_KERNEL);
      |                                        ^
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:55:11: error: invalid use of undefined type ‘struct gpio_chip’
   55 |         gc->base = test_mmio_buffer;
      |           ^~
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:56:17: error: invalid use of undefined type ‘struct amd_gpio’
   56 |         gpio_dev.base = gc->base;
      |                 ^
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:56:27: error: invalid use of undefined type ‘struct gpio_chip’
   56 |         gpio_dev.base = gc->base;
      |                           ^~
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:57:17: error: invalid use of undefined type ‘struct amd_gpio’
   57 |         gpio_dev.lock = __RAW_SPIN_LOCK_UNLOCKED(gpio_dev.lock);
      |                 ^
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:58:47: error: invalid use of undefined type ‘struct amd_gpio’
   58 |         writel(BIT(OUTPUT_VALUE_OFF), gpio_dev.base + offset * 4);
      |                                               ^
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:59:28: error: passing argument 1 of ‘amd_gpio_set_value’ from incompatible pointer type [-Werror=incompatible-pointer-types]
   59 |         amd_gpio_set_value(gc, offset, value);
      |                            ^~
      |                            |
      |                            struct gpio_chip *
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:12:49: note: expected ‘struct gpio_chip *’ but argument is of type ‘struct gpio_chip *’
   12 | static int amd_gpio_set_value(struct gpio_chip *gc, unsigned int offset, int value)
      |                               ~~~~~~~~~~~~~~~~~~^~
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:60:32: error: invalid use of undefined type ‘struct amd_gpio’
   60 |         result = readl(gpio_dev.base + offset * 4);
      |                                ^
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c: In function ‘test_amd_gpio_set_value_zero_offset’:
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:71:40: error: invalid application of ‘sizeof’ to incomplete type ‘struct gpio_chip’
   71 |         gc = kunit_kzalloc(test, sizeof(*gc), GFP_KERNEL);
      |                                        ^
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:72:11: error: invalid use of undefined type ‘struct gpio_chip’
   72 |         gc->base = test_mmio_buffer;
      |           ^~
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:73:17: error: invalid use of undefined type ‘struct amd_gpio’
   73 |         gpio_dev.base = gc->base;
      |                 ^
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:73:27: error: invalid use of undefined type ‘struct gpio_chip’
   73 |         gpio_dev.base = gc->base;
      |                           ^~
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:74:17: error: invalid use of undefined type ‘struct amd_gpio’
   74 |         gpio_dev.lock = __RAW_SPIN_LOCK_UNLOCKED(gpio_dev.lock);
      |                 ^
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:75:29: error: invalid use of undefined type ‘struct amd_gpio’
   75 |         writel(0x0, gpio_dev.base + offset * 4);
      |                             ^
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:76:28: error: passing argument 1 of ‘amd_gpio_set_value’ from incompatible pointer type [-Werror=incompatible-pointer-types]
   76 |         amd_gpio_set_value(gc, offset, value);
      |                            ^~
      |                            |
      |                            struct gpio_chip *
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:12:49: note: expected ‘struct gpio_chip *’ but argument is of type ‘struct gpio_chip *’
   12 | static int amd_gpio_set_value(struct gpio_chip *gc, unsigned int offset, int value)
      |                               ~~~~~~~~~~~~~~~~~~^~
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:77:32: error: invalid use of undefined type ‘struct amd_gpio’
   77 |         result = readl(gpio_dev.base + offset * 4);
      |                                ^
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c: In function ‘test_amd_gpio_set_value_max_offset’:
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:88:40: error: invalid application of ‘sizeof’ to incomplete type ‘struct gpio_chip’
   88 |         gc = kunit_kzalloc(test, sizeof(*gc), GFP_KERNEL);
      |                                        ^
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:89:11: error: invalid use of undefined type ‘struct gpio_chip’
   89 |         gc->base = test_mmio_buffer;
      |           ^~
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:90:17: error: invalid use of undefined type ‘struct amd_gpio’
   90 |         gpio_dev.base = gc->base;
      |                 ^
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:90:27: error: invalid use of undefined type ‘struct gpio_chip’
   90 |         gpio_dev.base = gc->base;
      |                           ^~
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:91:17: error: invalid use of undefined type ‘struct amd_gpio’
   91 |         gpio_dev.lock = __RAW_SPIN_LOCK_UNLOCKED(gpio_dev.lock);
      |                 ^
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:92:29: error: invalid use of undefined type ‘struct amd_gpio’
   92 |         writel(0x0, gpio_dev.base + offset * 4);
      |                             ^
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:93:28: error: passing argument 1 of ‘amd_gpio_set_value’ from incompatible pointer type [-Werror=incompatible-pointer-types]
   93 |         amd_gpio_set_value(gc, offset, value);
      |                            ^~
      |                            |
      |                            struct gpio_chip *
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:12:49: note: expected ‘struct gpio_chip *’ but argument is of type ‘struct gpio_chip *’
   12 | static int amd_gpio_set_value(struct gpio_chip *gc, unsigned int offset, int value)
      |                               ~~~~~~~~~~~~~~~~~~^~
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:94:32: error: invalid use of undefined type ‘struct amd_gpio’
   94 |         result = readl(gpio_dev.base + offset * 4);
      |                                ^
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c: In function ‘test_amd_gpio_set_value_already_set’:
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:105:40: error: invalid application of ‘sizeof’ to incomplete type ‘struct gpio_chip’
  105 |         gc = kunit_kzalloc(test, sizeof(*gc), GFP_KERNEL);
      |                                        ^
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:106:11: error: invalid use of undefined type ‘struct gpio_chip’
  106 |         gc->base = test_mmio_buffer;
      |           ^~
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:107:17: error: invalid use of undefined type ‘struct amd_gpio’
  107 |         gpio_dev.base = gc->base;
      |                 ^
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:107:27: error: invalid use of undefined type ‘struct gpio_chip’
  107 |         gpio_dev.base = gc->base;
      |                           ^~
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:108:17: error: invalid use of undefined type ‘struct amd_gpio’
  108 |         gpio_dev.lock = __RAW_SPIN_LOCK_UNLOCKED(gpio_dev.lock);
      |                 ^
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:109:47: error: invalid use of undefined type ‘struct amd_gpio’
  109 |         writel(BIT(OUTPUT_VALUE_OFF), gpio_dev.base + offset * 4);
      |                                               ^
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:110:28: error: passing argument 1 of ‘amd_gpio_set_value’ from incompatible pointer type [-Werror=incompatible-pointer-types]
  110 |         amd_gpio_set_value(gc, offset, value);
      |                            ^~
      |                            |
      |                            struct gpio_chip *
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:12:49: note: expected ‘struct gpio_chip *’ but argument is of type ‘struct gpio_chip *’
   12 | static int amd_gpio_set_value(struct gpio_chip *gc, unsigned int offset, int value)
      |                               ~~~~~~~~~~~~~~~~~~^~
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:111:32: error: invalid use of undefined type ‘struct amd_gpio’
  111 |         result = readl(gpio_dev.base + offset * 4);
      |                                ^
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c: In function ‘test_amd_gpio_set_value_already_clear’:
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:122:40: error: invalid application of ‘sizeof’ to incomplete type ‘struct gpio_chip’
  122 |         gc = kunit_kzalloc(test, sizeof(*gc), GFP_KERNEL);
      |                                        ^
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:123:11: error: invalid use of undefined type ‘struct gpio_chip’
  123 |         gc->base = test_mmio_buffer;
      |           ^~
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:124:17: error: invalid use of undefined type ‘struct amd_gpio’
  124 |         gpio_dev.base = gc->base;
      |                 ^
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:124:27: error: invalid use of undefined type ‘struct gpio_chip’
  124 |         gpio_dev.base = gc->base;
      |                           ^~
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:125:17: error: invalid use of undefined type ‘struct amd_gpio’
  125 |         gpio_dev.lock = __RAW_SPIN_LOCK_UNLOCKED(gpio_dev.lock);
      |                 ^
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:126:29: error: invalid use of undefined type ‘struct amd_gpio’
  126 |         writel(0x0, gpio_dev.base + offset * 4);
      |                             ^
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:127:28: error: passing argument 1 of ‘amd_gpio_set_value’ from incompatible pointer type [-Werror=incompatible-pointer-types]
  127 |         amd_gpio_set_value(gc, offset, value);
      |                            ^~
      |                            |
      |                            struct gpio_chip *
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:12:49: note: expected ‘struct gpio_chip *’ but argument is of type ‘struct gpio_chip *’
   12 | static int amd_gpio_set_value(struct gpio_chip *gc, unsigned int offset, int value)
      |                               ~~~~~~~~~~~~~~~~~~^~
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:128:32: error: invalid use of undefined type ‘struct amd_gpio’
  128 |         result = readl(gpio_dev.base + offset * 4);
      |                                ^
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c: At top level:
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:9:24: error: storage size of ‘gpio_dev’ isn’t known
    9 | static struct amd_gpio gpio_dev;
      |                        ^~~~~~~~
cc1: some warnings being treated as errors
make[5]: *** [../scripts/Makefile.build:287: drivers/pinctrl/amd_gpio_set_value_kunit_test.o] Error 1
make[5]: *** Waiting for unfinished jobs....
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:12:42: warning: ‘struct gpio_chip’ declared inside parameter list will not be visible outside of this definition or declaration
   12 | static int amd_gpio_get_direction(struct gpio_chip *gc, unsigned offset)
      |                                          ^~~~~~~~~
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c: In function ‘amd_gpio_get_direction’:
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:16:37: error: implicit declaration of function ‘gpiochip_get_data’ [-Werror=implicit-function-declaration]
   16 |         struct amd_gpio *gpio_dev = gpiochip_get_data(gc);
      |                                     ^~~~~~~~~~~~~~~~~
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:16:37: warning: initialization of ‘struct amd_gpio *’ from ‘int’ makes pointer from integer without a cast [-Wint-conversion]
In file included from ../include/linux/spinlock.h:314,
                 from ../include/linux/kref.h:16,
                 from ../include/kunit/test.h:22,
                 from ../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:1:
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:18:40: error: invalid use of undefined type ‘struct amd_gpio’
   18 |         raw_spin_lock_irqsave(&gpio_dev->lock, flags);
      |                                        ^~
../include/linux/spinlock_api_up.h:28:32: note: in definition of macro ‘___LOCK’
   28 |   do { __acquire(lock); (void)(lock); } while (0)
      |                                ^~~~
../include/linux/spinlock_api_up.h:40:31: note: in expansion of macro ‘__LOCK’
   40 |   do { local_irq_save(flags); __LOCK(lock); } while (0)
      |                               ^~~~~~
../include/linux/spinlock_api_up.h:69:49: note: in expansion of macro ‘__LOCK_IRQSAVE’
   69 | #define _raw_spin_lock_irqsave(lock, flags)     __LOCK_IRQSAVE(lock, flags)
      |                                                 ^~~~~~~~~~~~~~
../include/linux/spinlock.h:266:17: note: in expansion of macro ‘_raw_spin_lock_irqsave’
  266 |                 _raw_spin_lock_irqsave(lock, flags);    \
      |                 ^~~~~~~~~~~~~~~~~~~~~~
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:18:9: note: in expansion of macro ‘raw_spin_lock_irqsave’
   18 |         raw_spin_lock_irqsave(&gpio_dev->lock, flags);
      |         ^~~~~~~~~~~~~~~~~~~~~
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:19:33: error: invalid use of undefined type ‘struct amd_gpio’
   19 |         pin_reg = readl(gpio_dev->base + offset * 4);
      |                                 ^~
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:20:45: error: invalid use of undefined type ‘struct amd_gpio’
   20 |         raw_spin_unlock_irqrestore(&gpio_dev->lock, flags);
      |                                             ^~
../include/linux/spinlock_api_up.h:43:32: note: in definition of macro ‘___UNLOCK’
   43 |   do { __release(lock); (void)(lock); } while (0)
      |                                ^~~~
../include/linux/spinlock_api_up.h:56:34: note: in expansion of macro ‘__UNLOCK’
   56 |   do { local_irq_restore(flags); __UNLOCK(lock); } while (0)
      |                                  ^~~~~~~~
../include/linux/spinlock_api_up.h:86:41: note: in expansion of macro ‘__UNLOCK_IRQRESTORE’
   86 |                                         __UNLOCK_IRQRESTORE(lock, flags)
      |                                         ^~~~~~~~~~~~~~~~~~~
../include/linux/spinlock.h:282:17: note: in expansion of macro ‘_raw_spin_unlock_irqrestore’
  282 |                 _raw_spin_unlock_irqrestore(lock, flags);       \
      |                 ^~~~~~~~~~~~~~~~~~~~~~~~~~~
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:20:9: note: in expansion of macro ‘raw_spin_unlock_irqrestore’
   20 |         raw_spin_unlock_irqrestore(&gpio_dev->lock, flags);
      |         ^~~~~~~~~~~~~~~~~~~~~~~~~~
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:23:24: error: ‘GPIO_LINE_DIRECTION_OUT’ undeclared (first use in this function)
   23 |                 return GPIO_LINE_DIRECTION_OUT;
      |                        ^~~~~~~~~~~~~~~~~~~~~~~
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:23:24: note: each undeclared identifier is reported only once for each function it appears in
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:25:16: error: ‘GPIO_LINE_DIRECTION_IN’ undeclared (first use in this function)
   25 |         return GPIO_LINE_DIRECTION_IN;
      |                ^~~~~~~~~~~~~~~~~~~~~~
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c: In function ‘test_amd_gpio_get_direction_output’:
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:34:40: error: invalid application of ‘sizeof’ to incomplete type ‘struct gpio_chip’
   34 |         gc = kunit_kzalloc(test, sizeof(*gc), GFP_KERNEL);
      |                                        ^
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:35:11: error: invalid use of undefined type ‘struct gpio_chip’
   35 |         gc->base = test_mmio_buffer;
      |           ^~
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:36:17: error: invalid use of undefined type ‘struct amd_gpio’
   36 |         gpio_dev.base = gc->base;
      |                 ^
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:36:27: error: invalid use of undefined type ‘struct gpio_chip’
   36 |         gpio_dev.base = gc->base;
      |                           ^~
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:37:17: error: invalid use of undefined type ‘struct amd_gpio’
   37 |         gpio_dev.lock = __RAW_SPIN_LOCK_UNLOCKED(gpio_dev.lock);
      |                 ^
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:38:48: error: invalid use of undefined type ‘struct amd_gpio’
   38 |         writel(BIT(OUTPUT_ENABLE_OFF), gpio_dev.base + offset * 4);
      |                                                ^
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:40:41: error: passing argument 1 of ‘amd_gpio_get_direction’ from incompatible pointer type [-Werror=incompatible-pointer-types]
   40 |         result = amd_gpio_get_direction(gc, offset);
      |                                         ^~
      |                                         |
      |                                         struct gpio_chip *
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:12:53: note: expected ‘struct gpio_chip *’ but argument is of type ‘struct gpio_chip *’
   12 | static int amd_gpio_get_direction(struct gpio_chip *gc, unsigned offset)
      |                                   ~~~~~~~~~~~~~~~~~~^~
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:41:39: error: ‘GPIO_LINE_DIRECTION_OUT’ undeclared (first use in this function)
   41 |         KUNIT_EXPECT_EQ(test, result, GPIO_LINE_DIRECTION_OUT);
      |                                       ^~~~~~~~~~~~~~~~~~~~~~~
../include/kunit/test.h:776:22: note: in definition of macro ‘KUNIT_BASE_BINARY_ASSERTION’
  776 |         const typeof(right) __right = (right);                                 \
      |                      ^~~~~
../include/kunit/test.h:971:9: note: in expansion of macro ‘KUNIT_BINARY_INT_ASSERTION’
  971 |         KUNIT_BINARY_INT_ASSERTION(test,                                       \
      |         ^~~~~~~~~~~~~~~~~~~~~~~~~~
../include/kunit/test.h:968:9: note: in expansion of macro ‘KUNIT_EXPECT_EQ_MSG’
  968 |         KUNIT_EXPECT_EQ_MSG(test, left, right, NULL)
      |         ^~~~~~~~~~~~~~~~~~~
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:41:9: note: in expansion of macro ‘KUNIT_EXPECT_EQ’
   41 |         KUNIT_EXPECT_EQ(test, result, GPIO_LINE_DIRECTION_OUT);
      |         ^~~~~~~~~~~~~~~
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c: In function ‘test_amd_gpio_get_direction_input’:
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:50:40: error: invalid application of ‘sizeof’ to incomplete type ‘struct gpio_chip’
   50 |         gc = kunit_kzalloc(test, sizeof(*gc), GFP_KERNEL);
      |                                        ^
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:51:11: error: invalid use of undefined type ‘struct gpio_chip’
   51 |         gc->base = test_mmio_buffer;
      |           ^~
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:52:17: error: invalid use of undefined type ‘struct amd_gpio’
   52 |         gpio_dev.base = gc->base;
      |                 ^
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:52:27: error: invalid use of undefined type ‘struct gpio_chip’
   52 |         gpio_dev.base = gc->base;
      |                           ^~
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:53:17: error: invalid use of undefined type ‘struct amd_gpio’
   53 |         gpio_dev.lock = __RAW_SPIN_LOCK_UNLOCKED(gpio_dev.lock);
      |                 ^
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:54:29: error: invalid use of undefined type ‘struct amd_gpio’
   54 |         writel(0x0, gpio_dev.base + offset * 4);
      |                             ^
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:56:41: error: passing argument 1 of ‘amd_gpio_get_direction’ from incompatible pointer type [-Werror=incompatible-pointer-types]
   56 |         result = amd_gpio_get_direction(gc, offset);
      |                                         ^~
      |                                         |
      |                                         struct gpio_chip *
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:12:53: note: expected ‘struct gpio_chip *’ but argument is of type ‘struct gpio_chip *’
   12 | static int amd_gpio_get_direction(struct gpio_chip *gc, unsigned offset)
      |                                   ~~~~~~~~~~~~~~~~~~^~
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:57:39: error: ‘GPIO_LINE_DIRECTION_IN’ undeclared (first use in this function)
   57 |         KUNIT_EXPECT_EQ(test, result, GPIO_LINE_DIRECTION_IN);
      |                                       ^~~~~~~~~~~~~~~~~~~~~~
../include/kunit/test.h:776:22: note: in definition of macro ‘KUNIT_BASE_BINARY_ASSERTION’
  776 |         const typeof(right) __right = (right);                                 \
      |                      ^~~~~
../include/kunit/test.h:971:9: note: in expansion of macro ‘KUNIT_BINARY_INT_ASSERTION’
  971 |         KUNIT_BINARY_INT_ASSERTION(test,                                       \
      |         ^~~~~~~~~~~~~~~~~~~~~~~~~~
../include/kunit/test.h:968:9: note: in expansion of macro ‘KUNIT_EXPECT_EQ_MSG’
  968 |         KUNIT_EXPECT_EQ_MSG(test, left, right, NULL)
      |         ^~~~~~~~~~~~~~~~~~~
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:57:9: note: in expansion of macro ‘KUNIT_EXPECT_EQ’
   57 |         KUNIT_EXPECT_EQ(test, result, GPIO_LINE_DIRECTION_IN);
      |         ^~~~~~~~~~~~~~~
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c: In function ‘test_amd_gpio_get_direction_zero_offset’:
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:66:40: error: invalid application of ‘sizeof’ to incomplete type ‘struct gpio_chip’
   66 |         gc = kunit_kzalloc(test, sizeof(*gc), GFP_KERNEL);
      |                                        ^
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:67:11: error: invalid use of undefined type ‘struct gpio_chip’
   67 |         gc->base = test_mmio_buffer;
      |           ^~
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:68:17: error: invalid use of undefined type ‘struct amd_gpio’
   68 |         gpio_dev.base = gc->base;
      |                 ^
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:68:27: error: invalid use of undefined type ‘struct gpio_chip’
   68 |         gpio_dev.base = gc->base;
      |                           ^~
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:69:17: error: invalid use of undefined type ‘struct amd_gpio’
   69 |         gpio_dev.lock = __RAW_SPIN_LOCK_UNLOCKED(gpio_dev.lock);
      |                 ^
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:70:48: error: invalid use of undefined type ‘struct amd_gpio’
   70 |         writel(BIT(OUTPUT_ENABLE_OFF), gpio_dev.base + offset * 4);
      |                                                ^
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:72:41: error: passing argument 1 of ‘amd_gpio_get_direction’ from incompatible pointer type [-Werror=incompatible-pointer-types]
   72 |         result = amd_gpio_get_direction(gc, offset);
      |                                         ^~
      |                                         |
      |                                         struct gpio_chip *
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:12:53: note: expected ‘struct gpio_chip *’ but argument is of type ‘struct gpio_chip *’
   12 | static int amd_gpio_get_direction(struct gpio_chip *gc, unsigned offset)
      |                                   ~~~~~~~~~~~~~~~~~~^~
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:73:39: error: ‘GPIO_LINE_DIRECTION_OUT’ undeclared (first use in this function)
   73 |         KUNIT_EXPECT_EQ(test, result, GPIO_LINE_DIRECTION_OUT);
      |                                       ^~~~~~~~~~~~~~~~~~~~~~~
../include/kunit/test.h:776:22: note: in definition of macro ‘KUNIT_BASE_BINARY_ASSERTION’
  776 |         const typeof(right) __right = (right);                                 \
      |                      ^~~~~
../include/kunit/test.h:971:9: note: in expansion of macro ‘KUNIT_BINARY_INT_ASSERTION’
  971 |         KUNIT_BINARY_INT_ASSERTION(test,                                       \
      |         ^~~~~~~~~~~~~~~~~~~~~~~~~~
../include/kunit/test.h:968:9: note: in expansion of macro ‘KUNIT_EXPECT_EQ_MSG’
  968 |         KUNIT_EXPECT_EQ_MSG(test, left, right, NULL)
      |         ^~~~~~~~~~~~~~~~~~~
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:73:9: note: in expansion of macro ‘KUNIT_EXPECT_EQ’
   73 |         KUNIT_EXPECT_EQ(test, result, GPIO_LINE_DIRECTION_OUT);
      |         ^~~~~~~~~~~~~~~
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c: In function ‘test_amd_gpio_get_direction_max_offset’:
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:82:40: error: invalid application of ‘sizeof’ to incomplete type ‘struct gpio_chip’
   82 |         gc = kunit_kzalloc(test, sizeof(*gc), GFP_KERNEL);
      |                                        ^
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:83:11: error: invalid use of undefined type ‘struct gpio_chip’
   83 |         gc->base = test_mmio_buffer;
      |           ^~
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:84:17: error: invalid use of undefined type ‘struct amd_gpio’
   84 |         gpio_dev.base = gc->base;
      |                 ^
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:84:27: error: invalid use of undefined type ‘struct gpio_chip’
   84 |         gpio_dev.base = gc->base;
      |                           ^~
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:85:17: error: invalid use of undefined type ‘struct amd_gpio’
   85 |         gpio_dev.lock = __RAW_SPIN_LOCK_UNLOCKED(gpio_dev.lock);
      |                 ^
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:86:48: error: invalid use of undefined type ‘struct amd_gpio’
   86 |         writel(BIT(OUTPUT_ENABLE_OFF), gpio_dev.base + offset * 4);
      |                                                ^
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:88:41: error: passing argument 1 of ‘amd_gpio_get_direction’ from incompatible pointer type [-Werror=incompatible-pointer-types]
   88 |         result = amd_gpio_get_direction(gc, offset);
      |                                         ^~
      |                                         |
      |                                         struct gpio_chip *
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:12:53: note: expected ‘struct gpio_chip *’ but argument is of type ‘struct gpio_chip *’
   12 | static int amd_gpio_get_direction(struct gpio_chip *gc, unsigned offset)
      |                                   ~~~~~~~~~~~~~~~~~~^~
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:89:39: error: ‘GPIO_LINE_DIRECTION_OUT’ undeclared (first use in this function)
   89 |         KUNIT_EXPECT_EQ(test, result, GPIO_LINE_DIRECTION_OUT);
      |                                       ^~~~~~~~~~~~~~~~~~~~~~~
../include/kunit/test.h:776:22: note: in definition of macro ‘KUNIT_BASE_BINARY_ASSERTION’
  776 |         const typeof(right) __right = (right);                                 \
      |                      ^~~~~
../include/kunit/test.h:971:9: note: in expansion of macro ‘KUNIT_BINARY_INT_ASSERTION’
  971 |         KUNIT_BINARY_INT_ASSERTION(test,                                       \
      |         ^~~~~~~~~~~~~~~~~~~~~~~~~~
../include/kunit/test.h:968:9: note: in expansion of macro ‘KUNIT_EXPECT_EQ_MSG’
  968 |         KUNIT_EXPECT_EQ_MSG(test, left, right, NULL)
      |         ^~~~~~~~~~~~~~~~~~~
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:89:9: note: in expansion of macro ‘KUNIT_EXPECT_EQ’
   89 |         KUNIT_EXPECT_EQ(test, result, GPIO_LINE_DIRECTION_OUT);
      |         ^~~~~~~~~~~~~~~
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c: At top level:
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:9:24: error: storage size of ‘gpio_dev’ isn’t known
    9 | static struct amd_gpio gpio_dev;
      |                        ^~~~~~~~
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c: In function ‘amd_gpio_get_direction’:
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:26:1: error: control reaches end of non-void function [-Werror=return-type]
   26 | }
      | ^
cc1: some warnings being treated as errors
make[5]: *** [../scripts/Makefile.build:287: drivers/pinctrl/amd_gpio_get_direction_kunit_test.o] Error 1
make[4]: *** [../scripts/Makefile.build:554: drivers/pinctrl] Error 2
make[3]: *** [../scripts/Makefile.build:554: drivers] Error 2
make[3]: *** Waiting for unfinished jobs....
make[2]: *** [/home/amd/linux/Makefile:2003: .] Error 2
make[1]: *** [/home/amd/linux/Makefile:248: __sub-make] Error 2
make: *** [Makefile:248: __sub-make] Error 2

[20:28:23] Configuring KUnit Kernel ...
[20:28:23] Building KUnit Kernel ...
Populating config with:
$ make ARCH=x86_64 O=.kunit olddefconfig
Building with:
$ make all compile_commands.json scripts_gdb ARCH=x86_64 O=.kunit --jobs=4
ERROR:root:make[5]: Warning: File 'drivers/pinctrl/.amd_pinconf_set_kunit_test.o.cmd' has modification time 7331 s in the future
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:12:38: warning: ‘struct gpio_chip’ declared inside parameter list will not be visible outside of this definition or declaration
   12 | static int amd_gpio_set_value(struct gpio_chip *gc, unsigned int offset, int value)
      |                                      ^~~~~~~~~
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:12:42: warning: ‘struct gpio_chip’ declared inside parameter list will not be visible outside of this definition or declaration
   12 | static int amd_gpio_get_direction(struct gpio_chip *gc, unsigned offset)
      |                                          ^~~~~~~~~
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c: In function ‘amd_gpio_set_value’:
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:16:37: error: implicit declaration of function ‘gpiochip_get_data’ [-Werror=implicit-function-declaration]
   16 |         struct amd_gpio *gpio_dev = gpiochip_get_data(gc);
      |                                     ^~~~~~~~~~~~~~~~~
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:16:37: warning: initialization of ‘struct amd_gpio *’ from ‘int’ makes pointer from integer without a cast [-Wint-conversion]
In file included from ../include/linux/spinlock.h:314,
                 from ../include/linux/kref.h:16,
                 from ../include/kunit/test.h:22,
                 from ../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:1:
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:18:40: error: invalid use of undefined type ‘struct amd_gpio’
   18 |         raw_spin_lock_irqsave(&gpio_dev->lock, flags);
      |                                        ^~
../include/linux/spinlock_api_up.h:28:32: note: in definition of macro ‘___LOCK’
   28 |   do { __acquire(lock); (void)(lock); } while (0)
      |                                ^~~~
../include/linux/spinlock_api_up.h:40:31: note: in expansion of macro ‘__LOCK’
   40 |   do { local_irq_save(flags); __LOCK(lock); } while (0)
      |                               ^~~~~~
../include/linux/spinlock_api_up.h:69:49: note: in expansion of macro ‘__LOCK_IRQSAVE’
   69 | #define _raw_spin_lock_irqsave(lock, flags)     __LOCK_IRQSAVE(lock, flags)
      |                                                 ^~~~~~~~~~~~~~
../include/linux/spinlock.h:266:17: note: in expansion of macro ‘_raw_spin_lock_irqsave’
  266 |                 _raw_spin_lock_irqsave(lock, flags);    \
      |                 ^~~~~~~~~~~~~~~~~~~~~~
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:18:9: note: in expansion of macro ‘raw_spin_lock_irqsave’
   18 |         raw_spin_lock_irqsave(&gpio_dev->lock, flags);
      |         ^~~~~~~~~~~~~~~~~~~~~
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:19:33: error: invalid use of undefined type ‘struct amd_gpio’
   19 |         pin_reg = readl(gpio_dev->base + offset * 4);
      |                                 ^~
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:24:33: error: invalid use of undefined type ‘struct amd_gpio’
   24 |         writel(pin_reg, gpio_dev->base + offset * 4);
      |                                 ^~
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:25:45: error: invalid use of undefined type ‘struct amd_gpio’
   25 |         raw_spin_unlock_irqrestore(&gpio_dev->lock, flags);
      |                                             ^~
../include/linux/spinlock_api_up.h:43:32: note: in definition of macro ‘___UNLOCK’
   43 |   do { __release(lock); (void)(lock); } while (0)
      |                                ^~~~
../include/linux/spinlock_api_up.h:56:34: note: in expansion of macro ‘__UNLOCK’
   56 |   do { local_irq_restore(flags); __UNLOCK(lock); } while (0)
      |                                  ^~~~~~~~
../include/linux/spinlock_api_up.h:86:41: note: in expansion of macro ‘__UNLOCK_IRQRESTORE’
   86 |                                         __UNLOCK_IRQRESTORE(lock, flags)
      |                                         ^~~~~~~~~~~~~~~~~~~
../include/linux/spinlock.h:282:17: note: in expansion of macro ‘_raw_spin_unlock_irqrestore’
  282 |                 _raw_spin_unlock_irqrestore(lock, flags);       \
      |                 ^~~~~~~~~~~~~~~~~~~~~~~~~~~
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:25:9: note: in expansion of macro ‘raw_spin_unlock_irqrestore’
   25 |         raw_spin_unlock_irqrestore(&gpio_dev->lock, flags);
      |         ^~~~~~~~~~~~~~~~~~~~~~~~~~
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c: In function ‘test_amd_gpio_set_value_high’:
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:37:40: error: invalid application of ‘sizeof’ to incomplete type ‘struct gpio_chip’
   37 |         gc = kunit_kzalloc(test, sizeof(*gc), GFP_KERNEL);
      |                                        ^
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:38:11: error: invalid use of undefined type ‘struct gpio_chip’
   38 |         gc->base = test_mmio_buffer;
      |           ^~
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:39:17: error: invalid use of undefined type ‘struct amd_gpio’
   39 |         gpio_dev.base = gc->base;
      |                 ^
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:39:27: error: invalid use of undefined type ‘struct gpio_chip’
   39 |         gpio_dev.base = gc->base;
      |                           ^~
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:40:17: error: invalid use of undefined type ‘struct amd_gpio’
   40 |         gpio_dev.lock = __RAW_SPIN_LOCK_UNLOCKED(gpio_dev.lock);
      |                 ^
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:41:29: error: invalid use of undefined type ‘struct amd_gpio’
   41 |         writel(0x0, gpio_dev.base + offset * 4);
      |                             ^
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:42:28: error: passing argument 1 of ‘amd_gpio_set_value’ from incompatible pointer type [-Werror=incompatible-pointer-types]
   42 |         amd_gpio_set_value(gc, offset, value);
      |                            ^~
      |                            |
      |                            struct gpio_chip *
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:12:49: note: expected ‘struct gpio_chip *’ but argument is of type ‘struct gpio_chip *’
   12 | static int amd_gpio_set_value(struct gpio_chip *gc, unsigned int offset, int value)
      |                               ~~~~~~~~~~~~~~~~~~^~
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:43:32: error: invalid use of undefined type ‘struct amd_gpio’
   43 |         result = readl(gpio_dev.base + offset * 4);
      |                                ^
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c: In function ‘test_amd_gpio_set_value_low’:
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:54:40: error: invalid application of ‘sizeof’ to incomplete type ‘struct gpio_chip’
   54 |         gc = kunit_kzalloc(test, sizeof(*gc), GFP_KERNEL);
      |                                        ^
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:55:11: error: invalid use of undefined type ‘struct gpio_chip’
   55 |         gc->base = test_mmio_buffer;
      |           ^~
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:56:17: error: invalid use of undefined type ‘struct amd_gpio’
   56 |         gpio_dev.base = gc->base;
      |                 ^
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:56:27: error: invalid use of undefined type ‘struct gpio_chip’
   56 |         gpio_dev.base = gc->base;
      |                           ^~
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:57:17: error: invalid use of undefined type ‘struct amd_gpio’
   57 |         gpio_dev.lock = __RAW_SPIN_LOCK_UNLOCKED(gpio_dev.lock);
      |                 ^
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:58:47: error: invalid use of undefined type ‘struct amd_gpio’
   58 |         writel(BIT(OUTPUT_VALUE_OFF), gpio_dev.base + offset * 4);
      |                                               ^
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:59:28: error: passing argument 1 of ‘amd_gpio_set_value’ from incompatible pointer type [-Werror=incompatible-pointer-types]
   59 |         amd_gpio_set_value(gc, offset, value);
      |                            ^~
      |                            |
      |                            struct gpio_chip *
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:12:49: note: expected ‘struct gpio_chip *’ but argument is of type ‘struct gpio_chip *’
   12 | static int amd_gpio_set_value(struct gpio_chip *gc, unsigned int offset, int value)
      |                               ~~~~~~~~~~~~~~~~~~^~
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:60:32: error: invalid use of undefined type ‘struct amd_gpio’
   60 |         result = readl(gpio_dev.base + offset * 4);
      |                                ^
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c: In function ‘test_amd_gpio_set_value_zero_offset’:
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:71:40: error: invalid application of ‘sizeof’ to incomplete type ‘struct gpio_chip’
   71 |         gc = kunit_kzalloc(test, sizeof(*gc), GFP_KERNEL);
      |                                        ^
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:72:11: error: invalid use of undefined type ‘struct gpio_chip’
   72 |         gc->base = test_mmio_buffer;
      |           ^~
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:73:17: error: invalid use of undefined type ‘struct amd_gpio’
   73 |         gpio_dev.base = gc->base;
      |                 ^
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:73:27: error: invalid use of undefined type ‘struct gpio_chip’
   73 |         gpio_dev.base = gc->base;
      |                           ^~
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:74:17: error: invalid use of undefined type ‘struct amd_gpio’
   74 |         gpio_dev.lock = __RAW_SPIN_LOCK_UNLOCKED(gpio_dev.lock);
      |                 ^
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:75:29: error: invalid use of undefined type ‘struct amd_gpio’
   75 |         writel(0x0, gpio_dev.base + offset * 4);
      |                             ^
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:76:28: error: passing argument 1 of ‘amd_gpio_set_value’ from incompatible pointer type [-Werror=incompatible-pointer-types]
   76 |         amd_gpio_set_value(gc, offset, value);
      |                            ^~
      |                            |
      |                            struct gpio_chip *
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:12:49: note: expected ‘struct gpio_chip *’ but argument is of type ‘struct gpio_chip *’
   12 | static int amd_gpio_set_value(struct gpio_chip *gc, unsigned int offset, int value)
      |                               ~~~~~~~~~~~~~~~~~~^~
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:77:32: error: invalid use of undefined type ‘struct amd_gpio’
   77 |         result = readl(gpio_dev.base + offset * 4);
      |                                ^
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c: In function ‘test_amd_gpio_set_value_max_offset’:
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:88:40: error: invalid application of ‘sizeof’ to incomplete type ‘struct gpio_chip’
   88 |         gc = kunit_kzalloc(test, sizeof(*gc), GFP_KERNEL);
      |                                        ^
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:89:11: error: invalid use of undefined type ‘struct gpio_chip’
   89 |         gc->base = test_mmio_buffer;
      |           ^~
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:90:17: error: invalid use of undefined type ‘struct amd_gpio’
   90 |         gpio_dev.base = gc->base;
      |                 ^
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:90:27: error: invalid use of undefined type ‘struct gpio_chip’
   90 |         gpio_dev.base = gc->base;
      |                           ^~
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:91:17: error: invalid use of undefined type ‘struct amd_gpio’
   91 |         gpio_dev.lock = __RAW_SPIN_LOCK_UNLOCKED(gpio_dev.lock);
      |                 ^
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:92:29: error: invalid use of undefined type ‘struct amd_gpio’
   92 |         writel(0x0, gpio_dev.base + offset * 4);
      |                             ^
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:93:28: error: passing argument 1 of ‘amd_gpio_set_value’ from incompatible pointer type [-Werror=incompatible-pointer-types]
   93 |         amd_gpio_set_value(gc, offset, value);
      |                            ^~
      |                            |
      |                            struct gpio_chip *
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:12:49: note: expected ‘struct gpio_chip *’ but argument is of type ‘struct gpio_chip *’
   12 | static int amd_gpio_set_value(struct gpio_chip *gc, unsigned int offset, int value)
      |                               ~~~~~~~~~~~~~~~~~~^~
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:94:32: error: invalid use of undefined type ‘struct amd_gpio’
   94 |         result = readl(gpio_dev.base + offset * 4);
      |                                ^
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c: In function ‘test_amd_gpio_set_value_already_set’:
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:105:40: error: invalid application of ‘sizeof’ to incomplete type ‘struct gpio_chip’
  105 |         gc = kunit_kzalloc(test, sizeof(*gc), GFP_KERNEL);
      |                                        ^
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:106:11: error: invalid use of undefined type ‘struct gpio_chip’
  106 |         gc->base = test_mmio_buffer;
      |           ^~
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:107:17: error: invalid use of undefined type ‘struct amd_gpio’
  107 |         gpio_dev.base = gc->base;
      |                 ^
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:107:27: error: invalid use of undefined type ‘struct gpio_chip’
  107 |         gpio_dev.base = gc->base;
      |                           ^~
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:108:17: error: invalid use of undefined type ‘struct amd_gpio’
  108 |         gpio_dev.lock = __RAW_SPIN_LOCK_UNLOCKED(gpio_dev.lock);
      |                 ^
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:109:47: error: invalid use of undefined type ‘struct amd_gpio’
  109 |         writel(BIT(OUTPUT_VALUE_OFF), gpio_dev.base + offset * 4);
      |                                               ^
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:110:28: error: passing argument 1 of ‘amd_gpio_set_value’ from incompatible pointer type [-Werror=incompatible-pointer-types]
  110 |         amd_gpio_set_value(gc, offset, value);
      |                            ^~
      |                            |
      |                            struct gpio_chip *
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:12:49: note: expected ‘struct gpio_chip *’ but argument is of type ‘struct gpio_chip *’
   12 | static int amd_gpio_set_value(struct gpio_chip *gc, unsigned int offset, int value)
      |                               ~~~~~~~~~~~~~~~~~~^~
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:111:32: error: invalid use of undefined type ‘struct amd_gpio’
  111 |         result = readl(gpio_dev.base + offset * 4);
      |                                ^
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c: In function ‘test_amd_gpio_set_value_already_clear’:
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:122:40: error: invalid application of ‘sizeof’ to incomplete type ‘struct gpio_chip’
  122 |         gc = kunit_kzalloc(test, sizeof(*gc), GFP_KERNEL);
      |                                        ^
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:123:11: error: invalid use of undefined type ‘struct gpio_chip’
  123 |         gc->base = test_mmio_buffer;
      |           ^~
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:124:17: error: invalid use of undefined type ‘struct amd_gpio’
  124 |         gpio_dev.base = gc->base;
      |                 ^
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:124:27: error: invalid use of undefined type ‘struct gpio_chip’
  124 |         gpio_dev.base = gc->base;
      |                           ^~
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:125:17: error: invalid use of undefined type ‘struct amd_gpio’
  125 |         gpio_dev.lock = __RAW_SPIN_LOCK_UNLOCKED(gpio_dev.lock);
      |                 ^
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:126:29: error: invalid use of undefined type ‘struct amd_gpio’
  126 |         writel(0x0, gpio_dev.base + offset * 4);
      |                             ^
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:127:28: error: passing argument 1 of ‘amd_gpio_set_value’ from incompatible pointer type [-Werror=incompatible-pointer-types]
  127 |         amd_gpio_set_value(gc, offset, value);
      |                            ^~
      |                            |
      |                            struct gpio_chip *
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:12:49: note: expected ‘struct gpio_chip *’ but argument is of type ‘struct gpio_chip *’
   12 | static int amd_gpio_set_value(struct gpio_chip *gc, unsigned int offset, int value)
      |                               ~~~~~~~~~~~~~~~~~~^~
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:128:32: error: invalid use of undefined type ‘struct amd_gpio’
  128 |         result = readl(gpio_dev.base + offset * 4);
      |                                ^
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c: At top level:
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:9:24: error: storage size of ‘gpio_dev’ isn’t known
    9 | static struct amd_gpio gpio_dev;
      |                        ^~~~~~~~
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c: In function ‘amd_gpio_get_direction’:
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:16:37: error: implicit declaration of function ‘gpiochip_get_data’ [-Werror=implicit-function-declaration]
   16 |         struct amd_gpio *gpio_dev = gpiochip_get_data(gc);
      |                                     ^~~~~~~~~~~~~~~~~
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:16:37: warning: initialization of ‘struct amd_gpio *’ from ‘int’ makes pointer from integer without a cast [-Wint-conversion]
In file included from ../include/linux/spinlock.h:314,
                 from ../include/linux/kref.h:16,
                 from ../include/kunit/test.h:22,
                 from ../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:1:
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:18:40: error: invalid use of undefined type ‘struct amd_gpio’
   18 |         raw_spin_lock_irqsave(&gpio_dev->lock, flags);
      |                                        ^~
../include/linux/spinlock_api_up.h:28:32: note: in definition of macro ‘___LOCK’
   28 |   do { __acquire(lock); (void)(lock); } while (0)
      |                                ^~~~
../include/linux/spinlock_api_up.h:40:31: note: in expansion of macro ‘__LOCK’
   40 |   do { local_irq_save(flags); __LOCK(lock); } while (0)
      |                               ^~~~~~
../include/linux/spinlock_api_up.h:69:49: note: in expansion of macro ‘__LOCK_IRQSAVE’
   69 | #define _raw_spin_lock_irqsave(lock, flags)     __LOCK_IRQSAVE(lock, flags)
      |                                                 ^~~~~~~~~~~~~~
../include/linux/spinlock.h:266:17: note: in expansion of macro ‘_raw_spin_lock_irqsave’
  266 |                 _raw_spin_lock_irqsave(lock, flags);    \
      |                 ^~~~~~~~~~~~~~~~~~~~~~
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:18:9: note: in expansion of macro ‘raw_spin_lock_irqsave’
   18 |         raw_spin_lock_irqsave(&gpio_dev->lock, flags);
      |         ^~~~~~~~~~~~~~~~~~~~~
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:19:33: error: invalid use of undefined type ‘struct amd_gpio’
   19 |         pin_reg = readl(gpio_dev->base + offset * 4);
      |                                 ^~
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:20:45: error: invalid use of undefined type ‘struct amd_gpio’
   20 |         raw_spin_unlock_irqrestore(&gpio_dev->lock, flags);
      |                                             ^~
../include/linux/spinlock_api_up.h:43:32: note: in definition of macro ‘___UNLOCK’
   43 |   do { __release(lock); (void)(lock); } while (0)
      |                                ^~~~
../include/linux/spinlock_api_up.h:56:34: note: in expansion of macro ‘__UNLOCK’
   56 |   do { local_irq_restore(flags); __UNLOCK(lock); } while (0)
      |                                  ^~~~~~~~
../include/linux/spinlock_api_up.h:86:41: note: in expansion of macro ‘__UNLOCK_IRQRESTORE’
   86 |                                         __UNLOCK_IRQRESTORE(lock, flags)
      |                                         ^~~~~~~~~~~~~~~~~~~
../include/linux/spinlock.h:282:17: note: in expansion of macro ‘_raw_spin_unlock_irqrestore’
  282 |                 _raw_spin_unlock_irqrestore(lock, flags);       \
      |                 ^~~~~~~~~~~~~~~~~~~~~~~~~~~
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:20:9: note: in expansion of macro ‘raw_spin_unlock_irqrestore’
   20 |         raw_spin_unlock_irqrestore(&gpio_dev->lock, flags);
      |         ^~~~~~~~~~~~~~~~~~~~~~~~~~
cc1: some warnings being treated as errors
make[5]: *** [../scripts/Makefile.build:287: drivers/pinctrl/amd_gpio_set_value_kunit_test.o] Error 1
make[5]: *** Waiting for unfinished jobs....
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:23:24: error: ‘GPIO_LINE_DIRECTION_OUT’ undeclared (first use in this function)
   23 |                 return GPIO_LINE_DIRECTION_OUT;
      |                        ^~~~~~~~~~~~~~~~~~~~~~~
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:23:24: note: each undeclared identifier is reported only once for each function it appears in
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:25:16: error: ‘GPIO_LINE_DIRECTION_IN’ undeclared (first use in this function)
   25 |         return GPIO_LINE_DIRECTION_IN;
      |                ^~~~~~~~~~~~~~~~~~~~~~
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c: In function ‘test_amd_gpio_get_direction_output’:
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:34:40: error: invalid application of ‘sizeof’ to incomplete type ‘struct gpio_chip’
   34 |         gc = kunit_kzalloc(test, sizeof(*gc), GFP_KERNEL);
      |                                        ^
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:35:11: error: invalid use of undefined type ‘struct gpio_chip’
   35 |         gc->base = test_mmio_buffer;
      |           ^~
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:36:17: error: invalid use of undefined type ‘struct amd_gpio’
   36 |         gpio_dev.base = gc->base;
      |                 ^
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:36:27: error: invalid use of undefined type ‘struct gpio_chip’
   36 |         gpio_dev.base = gc->base;
      |                           ^~
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:37:17: error: invalid use of undefined type ‘struct amd_gpio’
   37 |         gpio_dev.lock = __RAW_SPIN_LOCK_UNLOCKED(gpio_dev.lock);
      |                 ^
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:38:48: error: invalid use of undefined type ‘struct amd_gpio’
   38 |         writel(BIT(OUTPUT_ENABLE_OFF), gpio_dev.base + offset * 4);
      |                                                ^
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:40:41: error: passing argument 1 of ‘amd_gpio_get_direction’ from incompatible pointer type [-Werror=incompatible-pointer-types]
   40 |         result = amd_gpio_get_direction(gc, offset);
      |                                         ^~
      |                                         |
      |                                         struct gpio_chip *
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:12:53: note: expected ‘struct gpio_chip *’ but argument is of type ‘struct gpio_chip *’
   12 | static int amd_gpio_get_direction(struct gpio_chip *gc, unsigned offset)
      |                                   ~~~~~~~~~~~~~~~~~~^~
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:41:39: error: ‘GPIO_LINE_DIRECTION_OUT’ undeclared (first use in this function)
   41 |         KUNIT_EXPECT_EQ(test, result, GPIO_LINE_DIRECTION_OUT);
      |                                       ^~~~~~~~~~~~~~~~~~~~~~~
../include/kunit/test.h:776:22: note: in definition of macro ‘KUNIT_BASE_BINARY_ASSERTION’
  776 |         const typeof(right) __right = (right);                                 \
      |                      ^~~~~
../include/kunit/test.h:971:9: note: in expansion of macro ‘KUNIT_BINARY_INT_ASSERTION’
  971 |         KUNIT_BINARY_INT_ASSERTION(test,                                       \
      |         ^~~~~~~~~~~~~~~~~~~~~~~~~~
../include/kunit/test.h:968:9: note: in expansion of macro ‘KUNIT_EXPECT_EQ_MSG’
  968 |         KUNIT_EXPECT_EQ_MSG(test, left, right, NULL)
      |         ^~~~~~~~~~~~~~~~~~~
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:41:9: note: in expansion of macro ‘KUNIT_EXPECT_EQ’
   41 |         KUNIT_EXPECT_EQ(test, result, GPIO_LINE_DIRECTION_OUT);
      |         ^~~~~~~~~~~~~~~
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c: In function ‘test_amd_gpio_get_direction_input’:
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:50:40: error: invalid application of ‘sizeof’ to incomplete type ‘struct gpio_chip’
   50 |         gc = kunit_kzalloc(test, sizeof(*gc), GFP_KERNEL);
      |                                        ^
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:51:11: error: invalid use of undefined type ‘struct gpio_chip’
   51 |         gc->base = test_mmio_buffer;
      |           ^~
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:52:17: error: invalid use of undefined type ‘struct amd_gpio’
   52 |         gpio_dev.base = gc->base;
      |                 ^
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:52:27: error: invalid use of undefined type ‘struct gpio_chip’
   52 |         gpio_dev.base = gc->base;
      |                           ^~
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:53:17: error: invalid use of undefined type ‘struct amd_gpio’
   53 |         gpio_dev.lock = __RAW_SPIN_LOCK_UNLOCKED(gpio_dev.lock);
      |                 ^
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:54:29: error: invalid use of undefined type ‘struct amd_gpio’
   54 |         writel(0x0, gpio_dev.base + offset * 4);
      |                             ^
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:56:41: error: passing argument 1 of ‘amd_gpio_get_direction’ from incompatible pointer type [-Werror=incompatible-pointer-types]
   56 |         result = amd_gpio_get_direction(gc, offset);
      |                                         ^~
      |                                         |
      |                                         struct gpio_chip *
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:12:53: note: expected ‘struct gpio_chip *’ but argument is of type ‘struct gpio_chip *’
   12 | static int amd_gpio_get_direction(struct gpio_chip *gc, unsigned offset)
      |                                   ~~~~~~~~~~~~~~~~~~^~
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:57:39: error: ‘GPIO_LINE_DIRECTION_IN’ undeclared (first use in this function)
   57 |         KUNIT_EXPECT_EQ(test, result, GPIO_LINE_DIRECTION_IN);
      |                                       ^~~~~~~~~~~~~~~~~~~~~~
../include/kunit/test.h:776:22: note: in definition of macro ‘KUNIT_BASE_BINARY_ASSERTION’
  776 |         const typeof(right) __right = (right);                                 \
      |                      ^~~~~
../include/kunit/test.h:971:9: note: in expansion of macro ‘KUNIT_BINARY_INT_ASSERTION’
  971 |         KUNIT_BINARY_INT_ASSERTION(test,                                       \
      |         ^~~~~~~~~~~~~~~~~~~~~~~~~~
../include/kunit/test.h:968:9: note: in expansion of macro ‘KUNIT_EXPECT_EQ_MSG’
  968 |         KUNIT_EXPECT_EQ_MSG(test, left, right, NULL)
      |         ^~~~~~~~~~~~~~~~~~~
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:57:9: note: in expansion of macro ‘KUNIT_EXPECT_EQ’
   57 |         KUNIT_EXPECT_EQ(test, result, GPIO_LINE_DIRECTION_IN);
      |         ^~~~~~~~~~~~~~~
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c: In function ‘test_amd_gpio_get_direction_zero_offset’:
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:66:40: error: invalid application of ‘sizeof’ to incomplete type ‘struct gpio_chip’
   66 |         gc = kunit_kzalloc(test, sizeof(*gc), GFP_KERNEL);
      |                                        ^
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:67:11: error: invalid use of undefined type ‘struct gpio_chip’
   67 |         gc->base = test_mmio_buffer;
      |           ^~
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:68:17: error: invalid use of undefined type ‘struct amd_gpio’
   68 |         gpio_dev.base = gc->base;
      |                 ^
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:68:27: error: invalid use of undefined type ‘struct gpio_chip’
   68 |         gpio_dev.base = gc->base;
      |                           ^~
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:69:17: error: invalid use of undefined type ‘struct amd_gpio’
   69 |         gpio_dev.lock = __RAW_SPIN_LOCK_UNLOCKED(gpio_dev.lock);
      |                 ^
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:70:48: error: invalid use of undefined type ‘struct amd_gpio’
   70 |         writel(BIT(OUTPUT_ENABLE_OFF), gpio_dev.base + offset * 4);
      |                                                ^
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:72:41: error: passing argument 1 of ‘amd_gpio_get_direction’ from incompatible pointer type [-Werror=incompatible-pointer-types]
   72 |         result = amd_gpio_get_direction(gc, offset);
      |                                         ^~
      |                                         |
      |                                         struct gpio_chip *
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:12:53: note: expected ‘struct gpio_chip *’ but argument is of type ‘struct gpio_chip *’
   12 | static int amd_gpio_get_direction(struct gpio_chip *gc, unsigned offset)
      |                                   ~~~~~~~~~~~~~~~~~~^~
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:73:39: error: ‘GPIO_LINE_DIRECTION_OUT’ undeclared (first use in this function)
   73 |         KUNIT_EXPECT_EQ(test, result, GPIO_LINE_DIRECTION_OUT);
      |                                       ^~~~~~~~~~~~~~~~~~~~~~~
../include/kunit/test.h:776:22: note: in definition of macro ‘KUNIT_BASE_BINARY_ASSERTION’
  776 |         const typeof(right) __right = (right);                                 \
      |                      ^~~~~
../include/kunit/test.h:971:9: note: in expansion of macro ‘KUNIT_BINARY_INT_ASSERTION’
  971 |         KUNIT_BINARY_INT_ASSERTION(test,                                       \
      |         ^~~~~~~~~~~~~~~~~~~~~~~~~~
../include/kunit/test.h:968:9: note: in expansion of macro ‘KUNIT_EXPECT_EQ_MSG’
  968 |         KUNIT_EXPECT_EQ_MSG(test, left, right, NULL)
      |         ^~~~~~~~~~~~~~~~~~~
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:73:9: note: in expansion of macro ‘KUNIT_EXPECT_EQ’
   73 |         KUNIT_EXPECT_EQ(test, result, GPIO_LINE_DIRECTION_OUT);
      |         ^~~~~~~~~~~~~~~
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c: In function ‘test_amd_gpio_get_direction_max_offset’:
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:82:40: error: invalid application of ‘sizeof’ to incomplete type ‘struct gpio_chip’
   82 |         gc = kunit_kzalloc(test, sizeof(*gc), GFP_KERNEL);
      |                                        ^
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:83:11: error: invalid use of undefined type ‘struct gpio_chip’
   83 |         gc->base = test_mmio_buffer;
      |           ^~
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:84:17: error: invalid use of undefined type ‘struct amd_gpio’
   84 |         gpio_dev.base = gc->base;
      |                 ^
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:84:27: error: invalid use of undefined type ‘struct gpio_chip’
   84 |         gpio_dev.base = gc->base;
      |                           ^~
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:85:17: error: invalid use of undefined type ‘struct amd_gpio’
   85 |         gpio_dev.lock = __RAW_SPIN_LOCK_UNLOCKED(gpio_dev.lock);
      |                 ^
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:86:48: error: invalid use of undefined type ‘struct amd_gpio’
   86 |         writel(BIT(OUTPUT_ENABLE_OFF), gpio_dev.base + offset * 4);
      |                                                ^
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:88:41: error: passing argument 1 of ‘amd_gpio_get_direction’ from incompatible pointer type [-Werror=incompatible-pointer-types]
   88 |         result = amd_gpio_get_direction(gc, offset);
      |                                         ^~
      |                                         |
      |                                         struct gpio_chip *
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:12:53: note: expected ‘struct gpio_chip *’ but argument is of type ‘struct gpio_chip *’
   12 | static int amd_gpio_get_direction(struct gpio_chip *gc, unsigned offset)
      |                                   ~~~~~~~~~~~~~~~~~~^~
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:89:39: error: ‘GPIO_LINE_DIRECTION_OUT’ undeclared (first use in this function)
   89 |         KUNIT_EXPECT_EQ(test, result, GPIO_LINE_DIRECTION_OUT);
      |                                       ^~~~~~~~~~~~~~~~~~~~~~~
../include/kunit/test.h:776:22: note: in definition of macro ‘KUNIT_BASE_BINARY_ASSERTION’
  776 |         const typeof(right) __right = (right);                                 \
      |                      ^~~~~
../include/kunit/test.h:971:9: note: in expansion of macro ‘KUNIT_BINARY_INT_ASSERTION’
  971 |         KUNIT_BINARY_INT_ASSERTION(test,                                       \
      |         ^~~~~~~~~~~~~~~~~~~~~~~~~~
../include/kunit/test.h:968:9: note: in expansion of macro ‘KUNIT_EXPECT_EQ_MSG’
  968 |         KUNIT_EXPECT_EQ_MSG(test, left, right, NULL)
      |         ^~~~~~~~~~~~~~~~~~~
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:89:9: note: in expansion of macro ‘KUNIT_EXPECT_EQ’
   89 |         KUNIT_EXPECT_EQ(test, result, GPIO_LINE_DIRECTION_OUT);
      |         ^~~~~~~~~~~~~~~
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c: At top level:
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:9:24: error: storage size of ‘gpio_dev’ isn’t known
    9 | static struct amd_gpio gpio_dev;
      |                        ^~~~~~~~
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c: In function ‘amd_gpio_get_direction’:
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:26:1: error: control reaches end of non-void function [-Werror=return-type]
   26 | }
      | ^
cc1: some warnings being treated as errors
make[5]: *** [../scripts/Makefile.build:287: drivers/pinctrl/amd_gpio_get_direction_kunit_test.o] Error 1
make[4]: *** [../scripts/Makefile.build:554: drivers/pinctrl] Error 2
make[4]: *** Waiting for unfinished jobs....
make[3]: *** [../scripts/Makefile.build:554: drivers] Error 2
make[3]: *** Waiting for unfinished jobs....
make[2]: *** [/home/amd/linux/Makefile:2003: .] Error 2
make[1]: *** [/home/amd/linux/Makefile:248: __sub-make] Error 2
make: *** [Makefile:248: __sub-make] Error 2

[20:29:43] Configuring KUnit Kernel ...
[20:29:43] Building KUnit Kernel ...
Populating config with:
$ make ARCH=x86_64 O=.kunit olddefconfig
Building with:
$ make all compile_commands.json scripts_gdb ARCH=x86_64 O=.kunit --jobs=4
ERROR:root:make[5]: Warning: File 'drivers/pinctrl/.amd_pinconf_set_kunit_test.o.cmd' has modification time 7297 s in the future
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:12:38: warning: ‘struct gpio_chip’ declared inside parameter list will not be visible outside of this definition or declaration
   12 | static int amd_gpio_set_value(struct gpio_chip *gc, unsigned int offset, int value)
      |                                      ^~~~~~~~~
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c: In function ‘amd_gpio_set_value’:
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:16:37: error: implicit declaration of function ‘gpiochip_get_data’ [-Werror=implicit-function-declaration]
   16 |         struct amd_gpio *gpio_dev = gpiochip_get_data(gc);
      |                                     ^~~~~~~~~~~~~~~~~
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:16:37: warning: initialization of ‘struct amd_gpio *’ from ‘int’ makes pointer from integer without a cast [-Wint-conversion]
In file included from ../include/linux/spinlock.h:314,
                 from ../include/linux/kref.h:16,
                 from ../include/kunit/test.h:22,
                 from ../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:1:
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:18:40: error: invalid use of undefined type ‘struct amd_gpio’
   18 |         raw_spin_lock_irqsave(&gpio_dev->lock, flags);
      |                                        ^~
../include/linux/spinlock_api_up.h:28:32: note: in definition of macro ‘___LOCK’
   28 |   do { __acquire(lock); (void)(lock); } while (0)
      |                                ^~~~
../include/linux/spinlock_api_up.h:40:31: note: in expansion of macro ‘__LOCK’
   40 |   do { local_irq_save(flags); __LOCK(lock); } while (0)
      |                               ^~~~~~
../include/linux/spinlock_api_up.h:69:49: note: in expansion of macro ‘__LOCK_IRQSAVE’
   69 | #define _raw_spin_lock_irqsave(lock, flags)     __LOCK_IRQSAVE(lock, flags)
      |                                                 ^~~~~~~~~~~~~~
../include/linux/spinlock.h:266:17: note: in expansion of macro ‘_raw_spin_lock_irqsave’
  266 |                 _raw_spin_lock_irqsave(lock, flags);    \
      |                 ^~~~~~~~~~~~~~~~~~~~~~
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:18:9: note: in expansion of macro ‘raw_spin_lock_irqsave’
   18 |         raw_spin_lock_irqsave(&gpio_dev->lock, flags);
      |         ^~~~~~~~~~~~~~~~~~~~~
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:19:33: error: invalid use of undefined type ‘struct amd_gpio’
   19 |         pin_reg = readl(gpio_dev->base + offset * 4);
      |                                 ^~
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:24:33: error: invalid use of undefined type ‘struct amd_gpio’
   24 |         writel(pin_reg, gpio_dev->base + offset * 4);
      |                                 ^~
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:25:45: error: invalid use of undefined type ‘struct amd_gpio’
   25 |         raw_spin_unlock_irqrestore(&gpio_dev->lock, flags);
      |                                             ^~
../include/linux/spinlock_api_up.h:43:32: note: in definition of macro ‘___UNLOCK’
   43 |   do { __release(lock); (void)(lock); } while (0)
      |                                ^~~~
../include/linux/spinlock_api_up.h:56:34: note: in expansion of macro ‘__UNLOCK’
   56 |   do { local_irq_restore(flags); __UNLOCK(lock); } while (0)
      |                                  ^~~~~~~~
../include/linux/spinlock_api_up.h:86:41: note: in expansion of macro ‘__UNLOCK_IRQRESTORE’
   86 |                                         __UNLOCK_IRQRESTORE(lock, flags)
      |                                         ^~~~~~~~~~~~~~~~~~~
../include/linux/spinlock.h:282:17: note: in expansion of macro ‘_raw_spin_unlock_irqrestore’
  282 |                 _raw_spin_unlock_irqrestore(lock, flags);       \
      |                 ^~~~~~~~~~~~~~~~~~~~~~~~~~~
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:25:9: note: in expansion of macro ‘raw_spin_unlock_irqrestore’
   25 |         raw_spin_unlock_irqrestore(&gpio_dev->lock, flags);
      |         ^~~~~~~~~~~~~~~~~~~~~~~~~~
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c: In function ‘test_amd_gpio_set_value_high’:
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:37:40: error: invalid application of ‘sizeof’ to incomplete type ‘struct gpio_chip’
   37 |         gc = kunit_kzalloc(test, sizeof(*gc), GFP_KERNEL);
      |                                        ^
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:38:11: error: invalid use of undefined type ‘struct gpio_chip’
   38 |         gc->base = test_mmio_buffer;
      |           ^~
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:39:17: error: invalid use of undefined type ‘struct amd_gpio’
   39 |         gpio_dev.base = gc->base;
      |                 ^
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:39:27: error: invalid use of undefined type ‘struct gpio_chip’
   39 |         gpio_dev.base = gc->base;
      |                           ^~
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:40:17: error: invalid use of undefined type ‘struct amd_gpio’
   40 |         gpio_dev.lock = __RAW_SPIN_LOCK_UNLOCKED(gpio_dev.lock);
      |                 ^
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:41:29: error: invalid use of undefined type ‘struct amd_gpio’
   41 |         writel(0x0, gpio_dev.base + offset * 4);
      |                             ^
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:42:28: error: passing argument 1 of ‘amd_gpio_set_value’ from incompatible pointer type [-Werror=incompatible-pointer-types]
   42 |         amd_gpio_set_value(gc, offset, value);
      |                            ^~
      |                            |
      |                            struct gpio_chip *
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:12:49: note: expected ‘struct gpio_chip *’ but argument is of type ‘struct gpio_chip *’
   12 | static int amd_gpio_set_value(struct gpio_chip *gc, unsigned int offset, int value)
      |                               ~~~~~~~~~~~~~~~~~~^~
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:43:32: error: invalid use of undefined type ‘struct amd_gpio’
   43 |         result = readl(gpio_dev.base + offset * 4);
      |                                ^
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c: In function ‘test_amd_gpio_set_value_low’:
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:54:40: error: invalid application of ‘sizeof’ to incomplete type ‘struct gpio_chip’
   54 |         gc = kunit_kzalloc(test, sizeof(*gc), GFP_KERNEL);
      |                                        ^
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:55:11: error: invalid use of undefined type ‘struct gpio_chip’
   55 |         gc->base = test_mmio_buffer;
      |           ^~
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:56:17: error: invalid use of undefined type ‘struct amd_gpio’
   56 |         gpio_dev.base = gc->base;
      |                 ^
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:56:27: error: invalid use of undefined type ‘struct gpio_chip’
   56 |         gpio_dev.base = gc->base;
      |                           ^~
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:57:17: error: invalid use of undefined type ‘struct amd_gpio’
   57 |         gpio_dev.lock = __RAW_SPIN_LOCK_UNLOCKED(gpio_dev.lock);
      |                 ^
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:58:47: error: invalid use of undefined type ‘struct amd_gpio’
   58 |         writel(BIT(OUTPUT_VALUE_OFF), gpio_dev.base + offset * 4);
      |                                               ^
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:59:28: error: passing argument 1 of ‘amd_gpio_set_value’ from incompatible pointer type [-Werror=incompatible-pointer-types]
   59 |         amd_gpio_set_value(gc, offset, value);
      |                            ^~
      |                            |
      |                            struct gpio_chip *
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:12:49: note: expected ‘struct gpio_chip *’ but argument is of type ‘struct gpio_chip *’
   12 | static int amd_gpio_set_value(struct gpio_chip *gc, unsigned int offset, int value)
      |                               ~~~~~~~~~~~~~~~~~~^~
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:60:32: error: invalid use of undefined type ‘struct amd_gpio’
   60 |         result = readl(gpio_dev.base + offset * 4);
      |                                ^
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c: In function ‘test_amd_gpio_set_value_zero_offset’:
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:71:40: error: invalid application of ‘sizeof’ to incomplete type ‘struct gpio_chip’
   71 |         gc = kunit_kzalloc(test, sizeof(*gc), GFP_KERNEL);
      |                                        ^
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:72:11: error: invalid use of undefined type ‘struct gpio_chip’
   72 |         gc->base = test_mmio_buffer;
      |           ^~
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:73:17: error: invalid use of undefined type ‘struct amd_gpio’
   73 |         gpio_dev.base = gc->base;
      |                 ^
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:73:27: error: invalid use of undefined type ‘struct gpio_chip’
   73 |         gpio_dev.base = gc->base;
      |                           ^~
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:74:17: error: invalid use of undefined type ‘struct amd_gpio’
   74 |         gpio_dev.lock = __RAW_SPIN_LOCK_UNLOCKED(gpio_dev.lock);
      |                 ^
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:75:29: error: invalid use of undefined type ‘struct amd_gpio’
   75 |         writel(0x0, gpio_dev.base + offset * 4);
      |                             ^
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:76:28: error: passing argument 1 of ‘amd_gpio_set_value’ from incompatible pointer type [-Werror=incompatible-pointer-types]
   76 |         amd_gpio_set_value(gc, offset, value);
      |                            ^~
      |                            |
      |                            struct gpio_chip *
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:12:49: note: expected ‘struct gpio_chip *’ but argument is of type ‘struct gpio_chip *’
   12 | static int amd_gpio_set_value(struct gpio_chip *gc, unsigned int offset, int value)
      |                               ~~~~~~~~~~~~~~~~~~^~
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:77:32: error: invalid use of undefined type ‘struct amd_gpio’
   77 |         result = readl(gpio_dev.base + offset * 4);
      |                                ^
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c: In function ‘test_amd_gpio_set_value_max_offset’:
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:88:40: error: invalid application of ‘sizeof’ to incomplete type ‘struct gpio_chip’
   88 |         gc = kunit_kzalloc(test, sizeof(*gc), GFP_KERNEL);
      |                                        ^
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:89:11: error: invalid use of undefined type ‘struct gpio_chip’
   89 |         gc->base = test_mmio_buffer;
      |           ^~
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:90:17: error: invalid use of undefined type ‘struct amd_gpio’
   90 |         gpio_dev.base = gc->base;
      |                 ^
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:90:27: error: invalid use of undefined type ‘struct gpio_chip’
   90 |         gpio_dev.base = gc->base;
      |                           ^~
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:91:17: error: invalid use of undefined type ‘struct amd_gpio’
   91 |         gpio_dev.lock = __RAW_SPIN_LOCK_UNLOCKED(gpio_dev.lock);
      |                 ^
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:92:29: error: invalid use of undefined type ‘struct amd_gpio’
   92 |         writel(0x0, gpio_dev.base + offset * 4);
      |                             ^
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:93:28: error: passing argument 1 of ‘amd_gpio_set_value’ from incompatible pointer type [-Werror=incompatible-pointer-types]
   93 |         amd_gpio_set_value(gc, offset, value);
      |                            ^~
      |                            |
      |                            struct gpio_chip *
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:12:49: note: expected ‘struct gpio_chip *’ but argument is of type ‘struct gpio_chip *’
   12 | static int amd_gpio_set_value(struct gpio_chip *gc, unsigned int offset, int value)
      |                               ~~~~~~~~~~~~~~~~~~^~
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:94:32: error: invalid use of undefined type ‘struct amd_gpio’
   94 |         result = readl(gpio_dev.base + offset * 4);
      |                                ^
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c: In function ‘test_amd_gpio_set_value_already_set’:
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:105:40: error: invalid application of ‘sizeof’ to incomplete type ‘struct gpio_chip’
  105 |         gc = kunit_kzalloc(test, sizeof(*gc), GFP_KERNEL);
      |                                        ^
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:106:11: error: invalid use of undefined type ‘struct gpio_chip’
  106 |         gc->base = test_mmio_buffer;
      |           ^~
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:107:17: error: invalid use of undefined type ‘struct amd_gpio’
  107 |         gpio_dev.base = gc->base;
      |                 ^
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:107:27: error: invalid use of undefined type ‘struct gpio_chip’
  107 |         gpio_dev.base = gc->base;
      |                           ^~
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:108:17: error: invalid use of undefined type ‘struct amd_gpio’
  108 |         gpio_dev.lock = __RAW_SPIN_LOCK_UNLOCKED(gpio_dev.lock);
      |                 ^
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:109:47: error: invalid use of undefined type ‘struct amd_gpio’
  109 |         writel(BIT(OUTPUT_VALUE_OFF), gpio_dev.base + offset * 4);
      |                                               ^
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:110:28: error: passing argument 1 of ‘amd_gpio_set_value’ from incompatible pointer type [-Werror=incompatible-pointer-types]
  110 |         amd_gpio_set_value(gc, offset, value);
      |                            ^~
      |                            |
      |                            struct gpio_chip *
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:12:49: note: expected ‘struct gpio_chip *’ but argument is of type ‘struct gpio_chip *’
   12 | static int amd_gpio_set_value(struct gpio_chip *gc, unsigned int offset, int value)
      |                               ~~~~~~~~~~~~~~~~~~^~
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:111:32: error: invalid use of undefined type ‘struct amd_gpio’
  111 |         result = readl(gpio_dev.base + offset * 4);
      |                                ^
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c: In function ‘test_amd_gpio_set_value_already_clear’:
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:122:40: error: invalid application of ‘sizeof’ to incomplete type ‘struct gpio_chip’
  122 |         gc = kunit_kzalloc(test, sizeof(*gc), GFP_KERNEL);
      |                                        ^
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:123:11: error: invalid use of undefined type ‘struct gpio_chip’
  123 |         gc->base = test_mmio_buffer;
      |           ^~
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:124:17: error: invalid use of undefined type ‘struct amd_gpio’
  124 |         gpio_dev.base = gc->base;
      |                 ^
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:124:27: error: invalid use of undefined type ‘struct gpio_chip’
  124 |         gpio_dev.base = gc->base;
      |                           ^~
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:125:17: error: invalid use of undefined type ‘struct amd_gpio’
  125 |         gpio_dev.lock = __RAW_SPIN_LOCK_UNLOCKED(gpio_dev.lock);
      |                 ^
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:126:29: error: invalid use of undefined type ‘struct amd_gpio’
  126 |         writel(0x0, gpio_dev.base + offset * 4);
      |                             ^
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:127:28: error: passing argument 1 of ‘amd_gpio_set_value’ from incompatible pointer type [-Werror=incompatible-pointer-types]
  127 |         amd_gpio_set_value(gc, offset, value);
      |                            ^~
      |                            |
      |                            struct gpio_chip *
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:12:49: note: expected ‘struct gpio_chip *’ but argument is of type ‘struct gpio_chip *’
   12 | static int amd_gpio_set_value(struct gpio_chip *gc, unsigned int offset, int value)
      |                               ~~~~~~~~~~~~~~~~~~^~
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:128:32: error: invalid use of undefined type ‘struct amd_gpio’
  128 |         result = readl(gpio_dev.base + offset * 4);
      |                                ^
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c: At top level:
../drivers/pinctrl/amd_gpio_set_value_kunit_test.c:9:24: error: storage size of ‘gpio_dev’ isn’t known
    9 | static struct amd_gpio gpio_dev;
      |                        ^~~~~~~~
cc1: some warnings being treated as errors
make[5]: *** [../scripts/Makefile.build:287: drivers/pinctrl/amd_gpio_set_value_kunit_test.o] Error 1
make[4]: *** [../scripts/Makefile.build:554: drivers/pinctrl] Error 2
make[4]: *** Waiting for unfinished jobs....
make[3]: *** [../scripts/Makefile.build:554: drivers] Error 2
make[3]: *** Waiting for unfinished jobs....
make[2]: *** [/home/amd/linux/Makefile:2003: .] Error 2
make[1]: *** [/home/amd/linux/Makefile:248: __sub-make] Error 2
make: *** [Makefile:248: __sub-make] Error 2

[20:30:20] Configuring KUnit Kernel ...
[20:30:20] Building KUnit Kernel ...
Populating config with:
$ make ARCH=x86_64 O=.kunit olddefconfig
Building with:
$ make all compile_commands.json scripts_gdb ARCH=x86_64 O=.kunit --jobs=4
ERROR:root:make[5]: Warning: File 'drivers/pinctrl/.amd_pinconf_set_kunit_test.o.cmd' has modification time 7261 s in the future
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:12:42: warning: ‘struct gpio_chip’ declared inside parameter list will not be visible outside of this definition or declaration
   12 | static int amd_gpio_get_direction(struct gpio_chip *gc, unsigned offset)
      |                                          ^~~~~~~~~
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c: In function ‘amd_gpio_get_direction’:
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:16:37: error: implicit declaration of function ‘gpiochip_get_data’ [-Werror=implicit-function-declaration]
   16 |         struct amd_gpio *gpio_dev = gpiochip_get_data(gc);
      |                                     ^~~~~~~~~~~~~~~~~
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:16:37: warning: initialization of ‘struct amd_gpio *’ from ‘int’ makes pointer from integer without a cast [-Wint-conversion]
In file included from ../include/linux/spinlock.h:314,
                 from ../include/linux/kref.h:16,
                 from ../include/kunit/test.h:22,
                 from ../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:1:
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:18:40: error: invalid use of undefined type ‘struct amd_gpio’
   18 |         raw_spin_lock_irqsave(&gpio_dev->lock, flags);
      |                                        ^~
../include/linux/spinlock_api_up.h:28:32: note: in definition of macro ‘___LOCK’
   28 |   do { __acquire(lock); (void)(lock); } while (0)
      |                                ^~~~
../include/linux/spinlock_api_up.h:40:31: note: in expansion of macro ‘__LOCK’
   40 |   do { local_irq_save(flags); __LOCK(lock); } while (0)
      |                               ^~~~~~
../include/linux/spinlock_api_up.h:69:49: note: in expansion of macro ‘__LOCK_IRQSAVE’
   69 | #define _raw_spin_lock_irqsave(lock, flags)     __LOCK_IRQSAVE(lock, flags)
      |                                                 ^~~~~~~~~~~~~~
../include/linux/spinlock.h:266:17: note: in expansion of macro ‘_raw_spin_lock_irqsave’
  266 |                 _raw_spin_lock_irqsave(lock, flags);    \
      |                 ^~~~~~~~~~~~~~~~~~~~~~
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:18:9: note: in expansion of macro ‘raw_spin_lock_irqsave’
   18 |         raw_spin_lock_irqsave(&gpio_dev->lock, flags);
      |         ^~~~~~~~~~~~~~~~~~~~~
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:19:33: error: invalid use of undefined type ‘struct amd_gpio’
   19 |         pin_reg = readl(gpio_dev->base + offset * 4);
      |                                 ^~
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:20:45: error: invalid use of undefined type ‘struct amd_gpio’
   20 |         raw_spin_unlock_irqrestore(&gpio_dev->lock, flags);
      |                                             ^~
../include/linux/spinlock_api_up.h:43:32: note: in definition of macro ‘___UNLOCK’
   43 |   do { __release(lock); (void)(lock); } while (0)
      |                                ^~~~
../include/linux/spinlock_api_up.h:56:34: note: in expansion of macro ‘__UNLOCK’
   56 |   do { local_irq_restore(flags); __UNLOCK(lock); } while (0)
      |                                  ^~~~~~~~
../include/linux/spinlock_api_up.h:86:41: note: in expansion of macro ‘__UNLOCK_IRQRESTORE’
   86 |                                         __UNLOCK_IRQRESTORE(lock, flags)
      |                                         ^~~~~~~~~~~~~~~~~~~
../include/linux/spinlock.h:282:17: note: in expansion of macro ‘_raw_spin_unlock_irqrestore’
  282 |                 _raw_spin_unlock_irqrestore(lock, flags);       \
      |                 ^~~~~~~~~~~~~~~~~~~~~~~~~~~
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:20:9: note: in expansion of macro ‘raw_spin_unlock_irqrestore’
   20 |         raw_spin_unlock_irqrestore(&gpio_dev->lock, flags);
      |         ^~~~~~~~~~~~~~~~~~~~~~~~~~
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:23:24: error: ‘GPIO_LINE_DIRECTION_OUT’ undeclared (first use in this function)
   23 |                 return GPIO_LINE_DIRECTION_OUT;
      |                        ^~~~~~~~~~~~~~~~~~~~~~~
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:23:24: note: each undeclared identifier is reported only once for each function it appears in
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:25:16: error: ‘GPIO_LINE_DIRECTION_IN’ undeclared (first use in this function)
   25 |         return GPIO_LINE_DIRECTION_IN;
      |                ^~~~~~~~~~~~~~~~~~~~~~
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c: In function ‘test_amd_gpio_get_direction_output’:
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:34:40: error: invalid application of ‘sizeof’ to incomplete type ‘struct gpio_chip’
   34 |         gc = kunit_kzalloc(test, sizeof(*gc), GFP_KERNEL);
      |                                        ^
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:35:11: error: invalid use of undefined type ‘struct gpio_chip’
   35 |         gc->base = test_mmio_buffer;
      |           ^~
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:36:17: error: invalid use of undefined type ‘struct amd_gpio’
   36 |         gpio_dev.base = gc->base;
      |                 ^
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:36:27: error: invalid use of undefined type ‘struct gpio_chip’
   36 |         gpio_dev.base = gc->base;
      |                           ^~
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:37:17: error: invalid use of undefined type ‘struct amd_gpio’
   37 |         gpio_dev.lock = __RAW_SPIN_LOCK_UNLOCKED(gpio_dev.lock);
      |                 ^
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:38:48: error: invalid use of undefined type ‘struct amd_gpio’
   38 |         writel(BIT(OUTPUT_ENABLE_OFF), gpio_dev.base + offset * 4);
      |                                                ^
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:40:41: error: passing argument 1 of ‘amd_gpio_get_direction’ from incompatible pointer type [-Werror=incompatible-pointer-types]
   40 |         result = amd_gpio_get_direction(gc, offset);
      |                                         ^~
      |                                         |
      |                                         struct gpio_chip *
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:12:53: note: expected ‘struct gpio_chip *’ but argument is of type ‘struct gpio_chip *’
   12 | static int amd_gpio_get_direction(struct gpio_chip *gc, unsigned offset)
      |                                   ~~~~~~~~~~~~~~~~~~^~
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:41:39: error: ‘GPIO_LINE_DIRECTION_OUT’ undeclared (first use in this function)
   41 |         KUNIT_EXPECT_EQ(test, result, GPIO_LINE_DIRECTION_OUT);
      |                                       ^~~~~~~~~~~~~~~~~~~~~~~
../include/kunit/test.h:776:22: note: in definition of macro ‘KUNIT_BASE_BINARY_ASSERTION’
  776 |         const typeof(right) __right = (right);                                 \
      |                      ^~~~~
../include/kunit/test.h:971:9: note: in expansion of macro ‘KUNIT_BINARY_INT_ASSERTION’
  971 |         KUNIT_BINARY_INT_ASSERTION(test,                                       \
      |         ^~~~~~~~~~~~~~~~~~~~~~~~~~
../include/kunit/test.h:968:9: note: in expansion of macro ‘KUNIT_EXPECT_EQ_MSG’
  968 |         KUNIT_EXPECT_EQ_MSG(test, left, right, NULL)
      |         ^~~~~~~~~~~~~~~~~~~
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:41:9: note: in expansion of macro ‘KUNIT_EXPECT_EQ’
   41 |         KUNIT_EXPECT_EQ(test, result, GPIO_LINE_DIRECTION_OUT);
      |         ^~~~~~~~~~~~~~~
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c: In function ‘test_amd_gpio_get_direction_input’:
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:50:40: error: invalid application of ‘sizeof’ to incomplete type ‘struct gpio_chip’
   50 |         gc = kunit_kzalloc(test, sizeof(*gc), GFP_KERNEL);
      |                                        ^
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:51:11: error: invalid use of undefined type ‘struct gpio_chip’
   51 |         gc->base = test_mmio_buffer;
      |           ^~
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:52:17: error: invalid use of undefined type ‘struct amd_gpio’
   52 |         gpio_dev.base = gc->base;
      |                 ^
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:52:27: error: invalid use of undefined type ‘struct gpio_chip’
   52 |         gpio_dev.base = gc->base;
      |                           ^~
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:53:17: error: invalid use of undefined type ‘struct amd_gpio’
   53 |         gpio_dev.lock = __RAW_SPIN_LOCK_UNLOCKED(gpio_dev.lock);
      |                 ^
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:54:29: error: invalid use of undefined type ‘struct amd_gpio’
   54 |         writel(0x0, gpio_dev.base + offset * 4);
      |                             ^
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:56:41: error: passing argument 1 of ‘amd_gpio_get_direction’ from incompatible pointer type [-Werror=incompatible-pointer-types]
   56 |         result = amd_gpio_get_direction(gc, offset);
      |                                         ^~
      |                                         |
      |                                         struct gpio_chip *
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:12:53: note: expected ‘struct gpio_chip *’ but argument is of type ‘struct gpio_chip *’
   12 | static int amd_gpio_get_direction(struct gpio_chip *gc, unsigned offset)
      |                                   ~~~~~~~~~~~~~~~~~~^~
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:57:39: error: ‘GPIO_LINE_DIRECTION_IN’ undeclared (first use in this function)
   57 |         KUNIT_EXPECT_EQ(test, result, GPIO_LINE_DIRECTION_IN);
      |                                       ^~~~~~~~~~~~~~~~~~~~~~
../include/kunit/test.h:776:22: note: in definition of macro ‘KUNIT_BASE_BINARY_ASSERTION’
  776 |         const typeof(right) __right = (right);                                 \
      |                      ^~~~~
../include/kunit/test.h:971:9: note: in expansion of macro ‘KUNIT_BINARY_INT_ASSERTION’
  971 |         KUNIT_BINARY_INT_ASSERTION(test,                                       \
      |         ^~~~~~~~~~~~~~~~~~~~~~~~~~
../include/kunit/test.h:968:9: note: in expansion of macro ‘KUNIT_EXPECT_EQ_MSG’
  968 |         KUNIT_EXPECT_EQ_MSG(test, left, right, NULL)
      |         ^~~~~~~~~~~~~~~~~~~
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:57:9: note: in expansion of macro ‘KUNIT_EXPECT_EQ’
   57 |         KUNIT_EXPECT_EQ(test, result, GPIO_LINE_DIRECTION_IN);
      |         ^~~~~~~~~~~~~~~
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c: In function ‘test_amd_gpio_get_direction_zero_offset’:
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:66:40: error: invalid application of ‘sizeof’ to incomplete type ‘struct gpio_chip’
   66 |         gc = kunit_kzalloc(test, sizeof(*gc), GFP_KERNEL);
      |                                        ^
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:67:11: error: invalid use of undefined type ‘struct gpio_chip’
   67 |         gc->base = test_mmio_buffer;
      |           ^~
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:68:17: error: invalid use of undefined type ‘struct amd_gpio’
   68 |         gpio_dev.base = gc->base;
      |                 ^
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:68:27: error: invalid use of undefined type ‘struct gpio_chip’
   68 |         gpio_dev.base = gc->base;
      |                           ^~
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:69:17: error: invalid use of undefined type ‘struct amd_gpio’
   69 |         gpio_dev.lock = __RAW_SPIN_LOCK_UNLOCKED(gpio_dev.lock);
      |                 ^
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:70:48: error: invalid use of undefined type ‘struct amd_gpio’
   70 |         writel(BIT(OUTPUT_ENABLE_OFF), gpio_dev.base + offset * 4);
      |                                                ^
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:72:41: error: passing argument 1 of ‘amd_gpio_get_direction’ from incompatible pointer type [-Werror=incompatible-pointer-types]
   72 |         result = amd_gpio_get_direction(gc, offset);
      |                                         ^~
      |                                         |
      |                                         struct gpio_chip *
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:12:53: note: expected ‘struct gpio_chip *’ but argument is of type ‘struct gpio_chip *’
   12 | static int amd_gpio_get_direction(struct gpio_chip *gc, unsigned offset)
      |                                   ~~~~~~~~~~~~~~~~~~^~
In file included from ../include/linux/spinlock.h:314,
                 from ../include/linux/kref.h:16,
                 from ../include/kunit/test.h:22,
                 from ../drivers/pinctrl/amd_gpio_irq_mask_kunit_test.c:1:
../drivers/pinctrl/amd_gpio_irq_mask_kunit_test.c: In function ‘amd_gpio_irq_mask’:
../drivers/pinctrl/amd_gpio_irq_mask_kunit_test.c:21:40: error: invalid use of undefined type ‘struct amd_gpio’
   21 |         raw_spin_lock_irqsave(&gpio_dev->lock, flags);
      |                                        ^~
../include/linux/spinlock_api_up.h:28:32: note: in definition of macro ‘___LOCK’
   28 |   do { __acquire(lock); (void)(lock); } while (0)
      |                                ^~~~
../include/linux/spinlock_api_up.h:40:31: note: in expansion of macro ‘__LOCK’
   40 |   do { local_irq_save(flags); __LOCK(lock); } while (0)
      |                               ^~~~~~
../include/linux/spinlock_api_up.h:69:49: note: in expansion of macro ‘__LOCK_IRQSAVE’
   69 | #define _raw_spin_lock_irqsave(lock, flags)     __LOCK_IRQSAVE(lock, flags)
      |                                                 ^~~~~~~~~~~~~~
../include/linux/spinlock.h:266:17: note: in expansion of macro ‘_raw_spin_lock_irqsave’
  266 |                 _raw_spin_lock_irqsave(lock, flags);    \
      |                 ^~~~~~~~~~~~~~~~~~~~~~
../drivers/pinctrl/amd_gpio_irq_mask_kunit_test.c:21:9: note: in expansion of macro ‘raw_spin_lock_irqsave’
   21 |         raw_spin_lock_irqsave(&gpio_dev->lock, flags);
      |         ^~~~~~~~~~~~~~~~~~~~~
../drivers/pinctrl/amd_gpio_irq_mask_kunit_test.c:22:33: error: invalid use of undefined type ‘struct amd_gpio’
   22 |         pin_reg = readl(gpio_dev->base + hwirq * 4);
      |                                 ^~
../drivers/pinctrl/amd_gpio_irq_mask_kunit_test.c:24:33: error: invalid use of undefined type ‘struct amd_gpio’
   24 |         writel(pin_reg, gpio_dev->base + hwirq * 4);
      |                                 ^~
../drivers/pinctrl/amd_gpio_irq_mask_kunit_test.c:25:45: error: invalid use of undefined type ‘struct amd_gpio’
   25 |         raw_spin_unlock_irqrestore(&gpio_dev->lock, flags);
      |                                             ^~
../include/linux/spinlock_api_up.h:43:32: note: in definition of macro ‘___UNLOCK’
   43 |   do { __release(lock); (void)(lock); } while (0)
      |                                ^~~~
../include/linux/spinlock_api_up.h:56:34: note: in expansion of macro ‘__UNLOCK’
   56 |   do { local_irq_restore(flags); __UNLOCK(lock); } while (0)
      |                                  ^~~~~~~~
../include/linux/spinlock_api_up.h:86:41: note: in expansion of macro ‘__UNLOCK_IRQRESTORE’
   86 |                                         __UNLOCK_IRQRESTORE(lock, flags)
      |                                         ^~~~~~~~~~~~~~~~~~~
../include/linux/spinlock.h:282:17: note: in expansion of macro ‘_raw_spin_unlock_irqrestore’
  282 |                 _raw_spin_unlock_irqrestore(lock, flags);       \
      |                 ^~~~~~~~~~~~~~~~~~~~~~~~~~~
../drivers/pinctrl/amd_gpio_irq_mask_kunit_test.c:25:9: note: in expansion of macro ‘raw_spin_unlock_irqrestore’
   25 |         raw_spin_unlock_irqrestore(&gpio_dev->lock, flags);
      |         ^~~~~~~~~~~~~~~~~~~~~~~~~~
../drivers/pinctrl/amd_gpio_irq_mask_kunit_test.c: In function ‘test_amd_gpio_irq_mask_valid_offset’:
../drivers/pinctrl/amd_gpio_irq_mask_kunit_test.c:34:17: warning: assignment to ‘int’ from ‘char *’ makes integer from pointer without a cast [-Wint-conversion]
   34 |         gc.base = test_mmio_buffer;
      |                 ^
../drivers/pinctrl/amd_gpio_irq_mask_kunit_test.c:35:11: error: ‘struct gpio_chip’ has no member named ‘parent_data’
   35 |         gc.parent_data = NULL;
      |           ^
../drivers/pinctrl/amd_gpio_irq_mask_kunit_test.c:39:12: error: ‘struct gpio_chip’ has no member named ‘of_node’; did you mean ‘fwnode’?
   39 |         gc.of_node = NULL;
      |            ^~~~~~~
      |            fwnode
../drivers/pinctrl/amd_gpio_irq_mask_kunit_test.c:41:18: error: incompatible types when assigning to type ‘struct gpio_irq_chip’ from type ‘int’
   41 |         gc.irq = 0;
      |                  ^
../drivers/pinctrl/amd_gpio_irq_mask_kunit_test.c:42:11: error: ‘struct gpio_chip’ has no member named ‘irqchip’
   42 |         gc.irqchip = NULL;
      |           ^
../drivers/pinctrl/amd_gpio_irq_mask_kunit_test.c:43:11: error: ‘struct gpio_chip’ has no member named ‘irqdomain’
   43 |         gc.irqdomain = NULL;
      |           ^
../drivers/pinctrl/amd_gpio_irq_mask_kunit_test.c:60:17: error: invalid use of undefined type ‘struct amd_gpio’
   60 |         gpio_dev.base = gc.base;
      |                 ^
../drivers/pinctrl/amd_gpio_irq_mask_kunit_test.c:61:17: error: invalid use of undefined type ‘struct amd_gpio’
   61 |         gpio_dev.lock = __RAW_SPIN_LOCK_UNLOCKED(gpio_dev.lock);
      |                 ^
../drivers/pinctrl/amd_gpio_irq_mask_kunit_test.c:64:16: error: assignment to ‘struct irq_chip *’ from incompatible pointer type ‘struct gpio_chip *’ [-Werror=incompatible-pointer-types]
   64 |         d.chip = &gc;
      |                ^
../drivers/pinctrl/amd_gpio_irq_mask_kunit_test.c:66:36: error: invalid use of undefined type ‘struct amd_gpio’
   66 |         writel(0xFFFFFFFF, gpio_dev.base + hwirq * 4);
      |                                    ^
../drivers/pinctrl/amd_gpio_irq_mask_kunit_test.c:68:36: error: invalid use of undefined type ‘struct amd_gpio’
   68 |         u32 result = readl(gpio_dev.base + hwirq * 4);
      |                                    ^
../drivers/pinctrl/amd_gpio_irq_mask_kunit_test.c: In function ‘test_amd_gpio_irq_mask_zero_offset’:
../drivers/pinctrl/amd_gpio_irq_mask_kunit_test.c:78:17: warning: assignment to ‘int’ from ‘char *’ makes integer from pointer without a cast [-Wint-conversion]
   78 |         gc.base = test_mmio_buffer;
      |                 ^
../drivers/pinctrl/amd_gpio_irq_mask_kunit_test.c:79:11: error: ‘struct gpio_chip’ has no member named ‘parent_data’
   79 |         gc.parent_data = NULL;
      |           ^
../drivers/pinctrl/amd_gpio_irq_mask_kunit_test.c:83:12: error: ‘struct gpio_chip’ has no member named ‘of_node’; did you mean ‘fwnode’?
   83 |         gc.of_node = NULL;
      |            ^~~~~~~
      |            fwnode
../drivers/pinctrl/amd_gpio_irq_mask_kunit_test.c:85:18: error: incompatible types when assigning to type ‘struct gpio_irq_chip’ from type ‘int’
   85 |         gc.irq = 0;
      |                  ^
../drivers/pinctrl/amd_gpio_irq_mask_kunit_test.c:86:11: error: ‘struct gpio_chip’ has no member named ‘irqchip’
   86 |         gc.irqchip = NULL;
      |           ^
../drivers/pinctrl/amd_gpio_irq_mask_kunit_test.c:87:11: error: ‘struct gpio_chip’ has no member named ‘irqdomain’
   87 |         gc.irqdomain = NULL;
      |           ^
../drivers/pinctrl/amd_gpio_irq_mask_kunit_test.c:104:17: error: invalid use of undefined type ‘struct amd_gpio’
  104 |         gpio_dev.base = gc.base;
      |                 ^
../drivers/pinctrl/amd_gpio_irq_mask_kunit_test.c:105:17: error: invalid use of undefined type ‘struct amd_gpio’
  105 |         gpio_dev.lock = __RAW_SPIN_LOCK_UNLOCKED(gpio_dev.lock);
      |                 ^
../drivers/pinctrl/amd_gpio_irq_mask_kunit_test.c:108:16: error: assignment to ‘struct irq_chip *’ from incompatible pointer type ‘struct gpio_chip *’ [-Werror=incompatible-pointer-types]
  108 |         d.chip = &gc;
      |                ^
../drivers/pinctrl/amd_gpio_irq_mask_kunit_test.c:110:36: error: invalid use of undefined type ‘struct amd_gpio’
  110 |         writel(0xFFFFFFFF, gpio_dev.base + hwirq * 4);
      |                                    ^
../drivers/pinctrl/amd_gpio_irq_mask_kunit_test.c:112:36: error: invalid use of undefined type ‘struct amd_gpio’
  112 |         u32 result = readl(gpio_dev.base + hwirq * 4);
      |                                    ^
../drivers/pinctrl/amd_gpio_irq_mask_kunit_test.c: In function ‘test_amd_gpio_irq_mask_max_offset’:
../drivers/pinctrl/amd_gpio_irq_mask_kunit_test.c:122:17: warning: assignment to ‘int’ from ‘char *’ makes integer from pointer without a cast [-Wint-conversion]
  122 |         gc.base = test_mmio_buffer;
      |                 ^
../drivers/pinctrl/amd_gpio_irq_mask_kunit_test.c:123:11: error: ‘struct gpio_chip’ has no member named ‘parent_data’
  123 |         gc.parent_data = NULL;
      |           ^
../drivers/pinctrl/amd_gpio_irq_mask_kunit_test.c:127:12: error: ‘struct gpio_chip’ has no member named ‘of_node’; did you mean ‘fwnode’?
  127 |         gc.of_node = NULL;
      |            ^~~~~~~
      |            fwnode
../drivers/pinctrl/amd_gpio_irq_mask_kunit_test.c:129:18: error: incompatible types when assigning to type ‘struct gpio_irq_chip’ from type ‘int’
  129 |         gc.irq = 0;
      |                  ^
../drivers/pinctrl/amd_gpio_irq_mask_kunit_test.c:130:11: error: ‘struct gpio_chip’ has no member named ‘irqchip’
  130 |         gc.irqchip = NULL;
      |           ^
../drivers/pinctrl/amd_gpio_irq_mask_kunit_test.c:131:11: error: ‘struct gpio_chip’ has no member named ‘irqdomain’
  131 |         gc.irqdomain = NULL;
      |           ^
../drivers/pinctrl/amd_gpio_irq_mask_kunit_test.c:148:17: error: invalid use of undefined type ‘struct amd_gpio’
  148 |         gpio_dev.base = gc.base;
      |                 ^
../drivers/pinctrl/amd_gpio_irq_mask_kunit_test.c:149:17: error: invalid use of undefined type ‘struct amd_gpio’
  149 |         gpio_dev.lock = __RAW_SPIN_LOCK_UNLOCKED(gpio_dev.lock);
      |                 ^
../drivers/pinctrl/amd_gpio_irq_mask_kunit_test.c:152:16: error: assignment to ‘struct irq_chip *’ from incompatible pointer type ‘struct gpio_chip *’ [-Werror=incompatible-pointer-types]
  152 |         d.chip = &gc;
      |                ^
../drivers/pinctrl/amd_gpio_irq_mask_kunit_test.c:154:36: error: invalid use of undefined type ‘struct amd_gpio’
  154 |         writel(0xFFFFFFFF, gpio_dev.base + hwirq * 4);
      |                                    ^
../drivers/pinctrl/amd_gpio_irq_mask_kunit_test.c:156:36: error: invalid use of undefined type ‘struct amd_gpio’
  156 |         u32 result = readl(gpio_dev.base + hwirq * 4);
      |                                    ^
../drivers/pinctrl/amd_gpio_irq_mask_kunit_test.c: At top level:
../drivers/pinctrl/amd_gpio_irq_mask_kunit_test.c:10:24: error: storage size of ‘gpio_dev’ isn’t known
   10 | static struct amd_gpio gpio_dev;
      |                        ^~~~~~~~
cc1: some warnings being treated as errors
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:73:39: error: ‘GPIO_LINE_DIRECTION_OUT’ undeclared (first use in this function)
   73 |         KUNIT_EXPECT_EQ(test, result, GPIO_LINE_DIRECTION_OUT);
      |                                       ^~~~~~~~~~~~~~~~~~~~~~~
../include/kunit/test.h:776:22: note: in definition of macro ‘KUNIT_BASE_BINARY_ASSERTION’
  776 |         const typeof(right) __right = (right);                                 \
      |                      ^~~~~
../include/kunit/test.h:971:9: note: in expansion of macro ‘KUNIT_BINARY_INT_ASSERTION’
  971 |         KUNIT_BINARY_INT_ASSERTION(test,                                       \
      |         ^~~~~~~~~~~~~~~~~~~~~~~~~~
../include/kunit/test.h:968:9: note: in expansion of macro ‘KUNIT_EXPECT_EQ_MSG’
  968 |         KUNIT_EXPECT_EQ_MSG(test, left, right, NULL)
      |         ^~~~~~~~~~~~~~~~~~~
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:73:9: note: in expansion of macro ‘KUNIT_EXPECT_EQ’
   73 |         KUNIT_EXPECT_EQ(test, result, GPIO_LINE_DIRECTION_OUT);
      |         ^~~~~~~~~~~~~~~
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c: In function ‘test_amd_gpio_get_direction_max_offset’:
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:82:40: error: invalid application of ‘sizeof’ to incomplete type ‘struct gpio_chip’
   82 |         gc = kunit_kzalloc(test, sizeof(*gc), GFP_KERNEL);
      |                                        ^
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:83:11: error: invalid use of undefined type ‘struct gpio_chip’
   83 |         gc->base = test_mmio_buffer;
      |           ^~
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:84:17: error: invalid use of undefined type ‘struct amd_gpio’
   84 |         gpio_dev.base = gc->base;
      |                 ^
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:84:27: error: invalid use of undefined type ‘struct gpio_chip’
   84 |         gpio_dev.base = gc->base;
      |                           ^~
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:85:17: error: invalid use of undefined type ‘struct amd_gpio’
   85 |         gpio_dev.lock = __RAW_SPIN_LOCK_UNLOCKED(gpio_dev.lock);
      |                 ^
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:86:48: error: invalid use of undefined type ‘struct amd_gpio’
   86 |         writel(BIT(OUTPUT_ENABLE_OFF), gpio_dev.base + offset * 4);
      |                                                ^
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:88:41: error: passing argument 1 of ‘amd_gpio_get_direction’ from incompatible pointer type [-Werror=incompatible-pointer-types]
   88 |         result = amd_gpio_get_direction(gc, offset);
      |                                         ^~
      |                                         |
      |                                         struct gpio_chip *
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:12:53: note: expected ‘struct gpio_chip *’ but argument is of type ‘struct gpio_chip *’
   12 | static int amd_gpio_get_direction(struct gpio_chip *gc, unsigned offset)
      |                                   ~~~~~~~~~~~~~~~~~~^~
make[5]: *** [../scripts/Makefile.build:287: drivers/pinctrl/amd_gpio_irq_mask_kunit_test.o] Error 1
make[5]: *** Waiting for unfinished jobs....
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:89:39: error: ‘GPIO_LINE_DIRECTION_OUT’ undeclared (first use in this function)
   89 |         KUNIT_EXPECT_EQ(test, result, GPIO_LINE_DIRECTION_OUT);
      |                                       ^~~~~~~~~~~~~~~~~~~~~~~
../include/kunit/test.h:776:22: note: in definition of macro ‘KUNIT_BASE_BINARY_ASSERTION’
  776 |         const typeof(right) __right = (right);                                 \
      |                      ^~~~~
../include/kunit/test.h:971:9: note: in expansion of macro ‘KUNIT_BINARY_INT_ASSERTION’
  971 |         KUNIT_BINARY_INT_ASSERTION(test,                                       \
      |         ^~~~~~~~~~~~~~~~~~~~~~~~~~
../include/kunit/test.h:968:9: note: in expansion of macro ‘KUNIT_EXPECT_EQ_MSG’
  968 |         KUNIT_EXPECT_EQ_MSG(test, left, right, NULL)
      |         ^~~~~~~~~~~~~~~~~~~
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:89:9: note: in expansion of macro ‘KUNIT_EXPECT_EQ’
   89 |         KUNIT_EXPECT_EQ(test, result, GPIO_LINE_DIRECTION_OUT);
      |         ^~~~~~~~~~~~~~~
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c: At top level:
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:9:24: error: storage size of ‘gpio_dev’ isn’t known
    9 | static struct amd_gpio gpio_dev;
      |                        ^~~~~~~~
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c: In function ‘amd_gpio_get_direction’:
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:26:1: error: control reaches end of non-void function [-Werror=return-type]
   26 | }
      | ^
cc1: some warnings being treated as errors
make[5]: *** [../scripts/Makefile.build:287: drivers/pinctrl/amd_gpio_get_direction_kunit_test.o] Error 1
make[4]: *** [../scripts/Makefile.build:554: drivers/pinctrl] Error 2
make[4]: *** Waiting for unfinished jobs....
make[3]: *** [../scripts/Makefile.build:554: drivers] Error 2
make[3]: *** Waiting for unfinished jobs....
make[2]: *** [/home/amd/linux/Makefile:2003: .] Error 2
make[1]: *** [/home/amd/linux/Makefile:248: __sub-make] Error 2
make: *** [Makefile:248: __sub-make] Error 2

[20:30:54] Configuring KUnit Kernel ...
[20:30:55] Building KUnit Kernel ...
Populating config with:
$ make ARCH=x86_64 O=.kunit olddefconfig
Building with:
$ make all compile_commands.json scripts_gdb ARCH=x86_64 O=.kunit --jobs=4
ERROR:root:make[5]: Warning: File 'drivers/pinctrl/.amd_pinconf_set_kunit_test.o.cmd' has modification time 7225 s in the future
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:12:42: warning: ‘struct gpio_chip’ declared inside parameter list will not be visible outside of this definition or declaration
   12 | static int amd_gpio_get_direction(struct gpio_chip *gc, unsigned offset)
      |                                          ^~~~~~~~~
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c: In function ‘amd_gpio_get_direction’:
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:16:37: error: implicit declaration of function ‘gpiochip_get_data’ [-Werror=implicit-function-declaration]
   16 |         struct amd_gpio *gpio_dev = gpiochip_get_data(gc);
      |                                     ^~~~~~~~~~~~~~~~~
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:16:37: warning: initialization of ‘struct amd_gpio *’ from ‘int’ makes pointer from integer without a cast [-Wint-conversion]
In file included from ../include/linux/spinlock.h:314,
                 from ../include/linux/kref.h:16,
                 from ../include/kunit/test.h:22,
                 from ../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:1:
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:18:40: error: invalid use of undefined type ‘struct amd_gpio’
   18 |         raw_spin_lock_irqsave(&gpio_dev->lock, flags);
      |                                        ^~
../include/linux/spinlock_api_up.h:28:32: note: in definition of macro ‘___LOCK’
   28 |   do { __acquire(lock); (void)(lock); } while (0)
      |                                ^~~~
../include/linux/spinlock_api_up.h:40:31: note: in expansion of macro ‘__LOCK’
   40 |   do { local_irq_save(flags); __LOCK(lock); } while (0)
      |                               ^~~~~~
../include/linux/spinlock_api_up.h:69:49: note: in expansion of macro ‘__LOCK_IRQSAVE’
   69 | #define _raw_spin_lock_irqsave(lock, flags)     __LOCK_IRQSAVE(lock, flags)
      |                                                 ^~~~~~~~~~~~~~
../include/linux/spinlock.h:266:17: note: in expansion of macro ‘_raw_spin_lock_irqsave’
  266 |                 _raw_spin_lock_irqsave(lock, flags);    \
      |                 ^~~~~~~~~~~~~~~~~~~~~~
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:18:9: note: in expansion of macro ‘raw_spin_lock_irqsave’
   18 |         raw_spin_lock_irqsave(&gpio_dev->lock, flags);
      |         ^~~~~~~~~~~~~~~~~~~~~
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:19:33: error: invalid use of undefined type ‘struct amd_gpio’
   19 |         pin_reg = readl(gpio_dev->base + offset * 4);
      |                                 ^~
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:20:45: error: invalid use of undefined type ‘struct amd_gpio’
   20 |         raw_spin_unlock_irqrestore(&gpio_dev->lock, flags);
      |                                             ^~
../include/linux/spinlock_api_up.h:43:32: note: in definition of macro ‘___UNLOCK’
   43 |   do { __release(lock); (void)(lock); } while (0)
      |                                ^~~~
../include/linux/spinlock_api_up.h:56:34: note: in expansion of macro ‘__UNLOCK’
   56 |   do { local_irq_restore(flags); __UNLOCK(lock); } while (0)
      |                                  ^~~~~~~~
../include/linux/spinlock_api_up.h:86:41: note: in expansion of macro ‘__UNLOCK_IRQRESTORE’
   86 |                                         __UNLOCK_IRQRESTORE(lock, flags)
      |                                         ^~~~~~~~~~~~~~~~~~~
../include/linux/spinlock.h:282:17: note: in expansion of macro ‘_raw_spin_unlock_irqrestore’
  282 |                 _raw_spin_unlock_irqrestore(lock, flags);       \
      |                 ^~~~~~~~~~~~~~~~~~~~~~~~~~~
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:20:9: note: in expansion of macro ‘raw_spin_unlock_irqrestore’
   20 |         raw_spin_unlock_irqrestore(&gpio_dev->lock, flags);
      |         ^~~~~~~~~~~~~~~~~~~~~~~~~~
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:23:24: error: ‘GPIO_LINE_DIRECTION_OUT’ undeclared (first use in this function)
   23 |                 return GPIO_LINE_DIRECTION_OUT;
      |                        ^~~~~~~~~~~~~~~~~~~~~~~
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:23:24: note: each undeclared identifier is reported only once for each function it appears in
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:25:16: error: ‘GPIO_LINE_DIRECTION_IN’ undeclared (first use in this function)
   25 |         return GPIO_LINE_DIRECTION_IN;
      |                ^~~~~~~~~~~~~~~~~~~~~~
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c: In function ‘test_amd_gpio_get_direction_output’:
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:34:40: error: invalid application of ‘sizeof’ to incomplete type ‘struct gpio_chip’
   34 |         gc = kunit_kzalloc(test, sizeof(*gc), GFP_KERNEL);
      |                                        ^
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:35:11: error: invalid use of undefined type ‘struct gpio_chip’
   35 |         gc->base = test_mmio_buffer;
      |           ^~
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:36:17: error: invalid use of undefined type ‘struct amd_gpio’
   36 |         gpio_dev.base = gc->base;
      |                 ^
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:36:27: error: invalid use of undefined type ‘struct gpio_chip’
   36 |         gpio_dev.base = gc->base;
      |                           ^~
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:37:17: error: invalid use of undefined type ‘struct amd_gpio’
   37 |         gpio_dev.lock = __RAW_SPIN_LOCK_UNLOCKED(gpio_dev.lock);
      |                 ^
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:38:48: error: invalid use of undefined type ‘struct amd_gpio’
   38 |         writel(BIT(OUTPUT_ENABLE_OFF), gpio_dev.base + offset * 4);
      |                                                ^
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:40:41: error: passing argument 1 of ‘amd_gpio_get_direction’ from incompatible pointer type [-Werror=incompatible-pointer-types]
   40 |         result = amd_gpio_get_direction(gc, offset);
      |                                         ^~
      |                                         |
      |                                         struct gpio_chip *
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:12:53: note: expected ‘struct gpio_chip *’ but argument is of type ‘struct gpio_chip *’
   12 | static int amd_gpio_get_direction(struct gpio_chip *gc, unsigned offset)
      |                                   ~~~~~~~~~~~~~~~~~~^~
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:41:39: error: ‘GPIO_LINE_DIRECTION_OUT’ undeclared (first use in this function)
   41 |         KUNIT_EXPECT_EQ(test, result, GPIO_LINE_DIRECTION_OUT);
      |                                       ^~~~~~~~~~~~~~~~~~~~~~~
../include/kunit/test.h:776:22: note: in definition of macro ‘KUNIT_BASE_BINARY_ASSERTION’
  776 |         const typeof(right) __right = (right);                                 \
      |                      ^~~~~
../include/kunit/test.h:971:9: note: in expansion of macro ‘KUNIT_BINARY_INT_ASSERTION’
  971 |         KUNIT_BINARY_INT_ASSERTION(test,                                       \
      |         ^~~~~~~~~~~~~~~~~~~~~~~~~~
../include/kunit/test.h:968:9: note: in expansion of macro ‘KUNIT_EXPECT_EQ_MSG’
  968 |         KUNIT_EXPECT_EQ_MSG(test, left, right, NULL)
      |         ^~~~~~~~~~~~~~~~~~~
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:41:9: note: in expansion of macro ‘KUNIT_EXPECT_EQ’
   41 |         KUNIT_EXPECT_EQ(test, result, GPIO_LINE_DIRECTION_OUT);
      |         ^~~~~~~~~~~~~~~
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c: In function ‘test_amd_gpio_get_direction_input’:
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:50:40: error: invalid application of ‘sizeof’ to incomplete type ‘struct gpio_chip’
   50 |         gc = kunit_kzalloc(test, sizeof(*gc), GFP_KERNEL);
      |                                        ^
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:51:11: error: invalid use of undefined type ‘struct gpio_chip’
   51 |         gc->base = test_mmio_buffer;
      |           ^~
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:52:17: error: invalid use of undefined type ‘struct amd_gpio’
   52 |         gpio_dev.base = gc->base;
      |                 ^
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:52:27: error: invalid use of undefined type ‘struct gpio_chip’
   52 |         gpio_dev.base = gc->base;
      |                           ^~
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:53:17: error: invalid use of undefined type ‘struct amd_gpio’
   53 |         gpio_dev.lock = __RAW_SPIN_LOCK_UNLOCKED(gpio_dev.lock);
      |                 ^
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:54:29: error: invalid use of undefined type ‘struct amd_gpio’
   54 |         writel(0x0, gpio_dev.base + offset * 4);
      |                             ^
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:56:41: error: passing argument 1 of ‘amd_gpio_get_direction’ from incompatible pointer type [-Werror=incompatible-pointer-types]
   56 |         result = amd_gpio_get_direction(gc, offset);
      |                                         ^~
      |                                         |
      |                                         struct gpio_chip *
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:12:53: note: expected ‘struct gpio_chip *’ but argument is of type ‘struct gpio_chip *’
   12 | static int amd_gpio_get_direction(struct gpio_chip *gc, unsigned offset)
      |                                   ~~~~~~~~~~~~~~~~~~^~
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:57:39: error: ‘GPIO_LINE_DIRECTION_IN’ undeclared (first use in this function)
   57 |         KUNIT_EXPECT_EQ(test, result, GPIO_LINE_DIRECTION_IN);
      |                                       ^~~~~~~~~~~~~~~~~~~~~~
../include/kunit/test.h:776:22: note: in definition of macro ‘KUNIT_BASE_BINARY_ASSERTION’
  776 |         const typeof(right) __right = (right);                                 \
      |                      ^~~~~
../include/kunit/test.h:971:9: note: in expansion of macro ‘KUNIT_BINARY_INT_ASSERTION’
  971 |         KUNIT_BINARY_INT_ASSERTION(test,                                       \
      |         ^~~~~~~~~~~~~~~~~~~~~~~~~~
../include/kunit/test.h:968:9: note: in expansion of macro ‘KUNIT_EXPECT_EQ_MSG’
  968 |         KUNIT_EXPECT_EQ_MSG(test, left, right, NULL)
      |         ^~~~~~~~~~~~~~~~~~~
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:57:9: note: in expansion of macro ‘KUNIT_EXPECT_EQ’
   57 |         KUNIT_EXPECT_EQ(test, result, GPIO_LINE_DIRECTION_IN);
      |         ^~~~~~~~~~~~~~~
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c: In function ‘test_amd_gpio_get_direction_zero_offset’:
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:66:40: error: invalid application of ‘sizeof’ to incomplete type ‘struct gpio_chip’
   66 |         gc = kunit_kzalloc(test, sizeof(*gc), GFP_KERNEL);
      |                                        ^
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:67:11: error: invalid use of undefined type ‘struct gpio_chip’
   67 |         gc->base = test_mmio_buffer;
      |           ^~
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:68:17: error: invalid use of undefined type ‘struct amd_gpio’
   68 |         gpio_dev.base = gc->base;
      |                 ^
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:68:27: error: invalid use of undefined type ‘struct gpio_chip’
   68 |         gpio_dev.base = gc->base;
      |                           ^~
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:69:17: error: invalid use of undefined type ‘struct amd_gpio’
   69 |         gpio_dev.lock = __RAW_SPIN_LOCK_UNLOCKED(gpio_dev.lock);
      |                 ^
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:70:48: error: invalid use of undefined type ‘struct amd_gpio’
   70 |         writel(BIT(OUTPUT_ENABLE_OFF), gpio_dev.base + offset * 4);
      |                                                ^
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:72:41: error: passing argument 1 of ‘amd_gpio_get_direction’ from incompatible pointer type [-Werror=incompatible-pointer-types]
   72 |         result = amd_gpio_get_direction(gc, offset);
      |                                         ^~
      |                                         |
      |                                         struct gpio_chip *
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:12:53: note: expected ‘struct gpio_chip *’ but argument is of type ‘struct gpio_chip *’
   12 | static int amd_gpio_get_direction(struct gpio_chip *gc, unsigned offset)
      |                                   ~~~~~~~~~~~~~~~~~~^~
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:73:39: error: ‘GPIO_LINE_DIRECTION_OUT’ undeclared (first use in this function)
   73 |         KUNIT_EXPECT_EQ(test, result, GPIO_LINE_DIRECTION_OUT);
      |                                       ^~~~~~~~~~~~~~~~~~~~~~~
../include/kunit/test.h:776:22: note: in definition of macro ‘KUNIT_BASE_BINARY_ASSERTION’
  776 |         const typeof(right) __right = (right);                                 \
      |                      ^~~~~
../include/kunit/test.h:971:9: note: in expansion of macro ‘KUNIT_BINARY_INT_ASSERTION’
  971 |         KUNIT_BINARY_INT_ASSERTION(test,                                       \
      |         ^~~~~~~~~~~~~~~~~~~~~~~~~~
../include/kunit/test.h:968:9: note: in expansion of macro ‘KUNIT_EXPECT_EQ_MSG’
  968 |         KUNIT_EXPECT_EQ_MSG(test, left, right, NULL)
      |         ^~~~~~~~~~~~~~~~~~~
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:73:9: note: in expansion of macro ‘KUNIT_EXPECT_EQ’
   73 |         KUNIT_EXPECT_EQ(test, result, GPIO_LINE_DIRECTION_OUT);
      |         ^~~~~~~~~~~~~~~
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c: In function ‘test_amd_gpio_get_direction_max_offset’:
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:82:40: error: invalid application of ‘sizeof’ to incomplete type ‘struct gpio_chip’
   82 |         gc = kunit_kzalloc(test, sizeof(*gc), GFP_KERNEL);
      |                                        ^
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:83:11: error: invalid use of undefined type ‘struct gpio_chip’
   83 |         gc->base = test_mmio_buffer;
      |           ^~
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:84:17: error: invalid use of undefined type ‘struct amd_gpio’
   84 |         gpio_dev.base = gc->base;
      |                 ^
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:84:27: error: invalid use of undefined type ‘struct gpio_chip’
   84 |         gpio_dev.base = gc->base;
      |                           ^~
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:85:17: error: invalid use of undefined type ‘struct amd_gpio’
   85 |         gpio_dev.lock = __RAW_SPIN_LOCK_UNLOCKED(gpio_dev.lock);
      |                 ^
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:86:48: error: invalid use of undefined type ‘struct amd_gpio’
   86 |         writel(BIT(OUTPUT_ENABLE_OFF), gpio_dev.base + offset * 4);
      |                                                ^
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:88:41: error: passing argument 1 of ‘amd_gpio_get_direction’ from incompatible pointer type [-Werror=incompatible-pointer-types]
   88 |         result = amd_gpio_get_direction(gc, offset);
      |                                         ^~
      |                                         |
      |                                         struct gpio_chip *
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:12:53: note: expected ‘struct gpio_chip *’ but argument is of type ‘struct gpio_chip *’
   12 | static int amd_gpio_get_direction(struct gpio_chip *gc, unsigned offset)
      |                                   ~~~~~~~~~~~~~~~~~~^~
In file included from ../include/linux/spinlock.h:314,
                 from ../include/linux/kref.h:16,
                 from ../include/kunit/test.h:22,
                 from ../drivers/pinctrl/amd_gpio_irq_mask_kunit_test.c:1:
../drivers/pinctrl/amd_gpio_irq_mask_kunit_test.c: In function ‘amd_gpio_irq_mask’:
../drivers/pinctrl/amd_gpio_irq_mask_kunit_test.c:21:40: error: invalid use of undefined type ‘struct amd_gpio’
   21 |         raw_spin_lock_irqsave(&gpio_dev->lock, flags);
      |                                        ^~
../include/linux/spinlock_api_up.h:28:32: note: in definition of macro ‘___LOCK’
   28 |   do { __acquire(lock); (void)(lock); } while (0)
      |                                ^~~~
../include/linux/spinlock_api_up.h:40:31: note: in expansion of macro ‘__LOCK’
   40 |   do { local_irq_save(flags); __LOCK(lock); } while (0)
      |                               ^~~~~~
../include/linux/spinlock_api_up.h:69:49: note: in expansion of macro ‘__LOCK_IRQSAVE’
   69 | #define _raw_spin_lock_irqsave(lock, flags)     __LOCK_IRQSAVE(lock, flags)
      |                                                 ^~~~~~~~~~~~~~
../include/linux/spinlock.h:266:17: note: in expansion of macro ‘_raw_spin_lock_irqsave’
  266 |                 _raw_spin_lock_irqsave(lock, flags);    \
      |                 ^~~~~~~~~~~~~~~~~~~~~~
../drivers/pinctrl/amd_gpio_irq_mask_kunit_test.c:21:9: note: in expansion of macro ‘raw_spin_lock_irqsave’
   21 |         raw_spin_lock_irqsave(&gpio_dev->lock, flags);
      |         ^~~~~~~~~~~~~~~~~~~~~
../drivers/pinctrl/amd_gpio_irq_mask_kunit_test.c:22:33: error: invalid use of undefined type ‘struct amd_gpio’
   22 |         pin_reg = readl(gpio_dev->base + hwirq * 4);
      |                                 ^~
../drivers/pinctrl/amd_gpio_irq_mask_kunit_test.c:24:33: error: invalid use of undefined type ‘struct amd_gpio’
   24 |         writel(pin_reg, gpio_dev->base + hwirq * 4);
      |                                 ^~
../drivers/pinctrl/amd_gpio_irq_mask_kunit_test.c:25:45: error: invalid use of undefined type ‘struct amd_gpio’
   25 |         raw_spin_unlock_irqrestore(&gpio_dev->lock, flags);
      |                                             ^~
../include/linux/spinlock_api_up.h:43:32: note: in definition of macro ‘___UNLOCK’
   43 |   do { __release(lock); (void)(lock); } while (0)
      |                                ^~~~
../include/linux/spinlock_api_up.h:56:34: note: in expansion of macro ‘__UNLOCK’
   56 |   do { local_irq_restore(flags); __UNLOCK(lock); } while (0)
      |                                  ^~~~~~~~
../include/linux/spinlock_api_up.h:86:41: note: in expansion of macro ‘__UNLOCK_IRQRESTORE’
   86 |                                         __UNLOCK_IRQRESTORE(lock, flags)
      |                                         ^~~~~~~~~~~~~~~~~~~
../include/linux/spinlock.h:282:17: note: in expansion of macro ‘_raw_spin_unlock_irqrestore’
  282 |                 _raw_spin_unlock_irqrestore(lock, flags);       \
      |                 ^~~~~~~~~~~~~~~~~~~~~~~~~~~
../drivers/pinctrl/amd_gpio_irq_mask_kunit_test.c:25:9: note: in expansion of macro ‘raw_spin_unlock_irqrestore’
   25 |         raw_spin_unlock_irqrestore(&gpio_dev->lock, flags);
      |         ^~~~~~~~~~~~~~~~~~~~~~~~~~
../drivers/pinctrl/amd_gpio_irq_mask_kunit_test.c: In function ‘test_amd_gpio_irq_mask_valid_offset’:
../drivers/pinctrl/amd_gpio_irq_mask_kunit_test.c:34:17: warning: assignment to ‘int’ from ‘char *’ makes integer from pointer without a cast [-Wint-conversion]
   34 |         gc.base = test_mmio_buffer;
      |                 ^
../drivers/pinctrl/amd_gpio_irq_mask_kunit_test.c:35:11: error: ‘struct gpio_chip’ has no member named ‘parent_data’
   35 |         gc.parent_data = NULL;
      |           ^
../drivers/pinctrl/amd_gpio_irq_mask_kunit_test.c:39:12: error: ‘struct gpio_chip’ has no member named ‘of_node’; did you mean ‘fwnode’?
   39 |         gc.of_node = NULL;
      |            ^~~~~~~
      |            fwnode
../drivers/pinctrl/amd_gpio_irq_mask_kunit_test.c:41:18: error: incompatible types when assigning to type ‘struct gpio_irq_chip’ from type ‘int’
   41 |         gc.irq = 0;
      |                  ^
../drivers/pinctrl/amd_gpio_irq_mask_kunit_test.c:42:11: error: ‘struct gpio_chip’ has no member named ‘irqchip’
   42 |         gc.irqchip = NULL;
      |           ^
../drivers/pinctrl/amd_gpio_irq_mask_kunit_test.c:43:11: error: ‘struct gpio_chip’ has no member named ‘irqdomain’
   43 |         gc.irqdomain = NULL;
      |           ^
../drivers/pinctrl/amd_gpio_irq_mask_kunit_test.c:60:17: error: invalid use of undefined type ‘struct amd_gpio’
   60 |         gpio_dev.base = gc.base;
      |                 ^
../drivers/pinctrl/amd_gpio_irq_mask_kunit_test.c:61:17: error: invalid use of undefined type ‘struct amd_gpio’
   61 |         gpio_dev.lock = __RAW_SPIN_LOCK_UNLOCKED(gpio_dev.lock);
      |                 ^
../drivers/pinctrl/amd_gpio_irq_mask_kunit_test.c:64:16: error: assignment to ‘struct irq_chip *’ from incompatible pointer type ‘struct gpio_chip *’ [-Werror=incompatible-pointer-types]
   64 |         d.chip = &gc;
      |                ^
../drivers/pinctrl/amd_gpio_irq_mask_kunit_test.c:66:36: error: invalid use of undefined type ‘struct amd_gpio’
   66 |         writel(0xFFFFFFFF, gpio_dev.base + hwirq * 4);
      |                                    ^
../drivers/pinctrl/amd_gpio_irq_mask_kunit_test.c:68:36: error: invalid use of undefined type ‘struct amd_gpio’
   68 |         u32 result = readl(gpio_dev.base + hwirq * 4);
      |                                    ^
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:89:39: error: ‘GPIO_LINE_DIRECTION_OUT’ undeclared (first use in this function)
   89 |         KUNIT_EXPECT_EQ(test, result, GPIO_LINE_DIRECTION_OUT);
      |                                       ^~~~~~~~~~~~~~~~~~~~~~~
../include/kunit/test.h:776:22: note: in definition of macro ‘KUNIT_BASE_BINARY_ASSERTION’
  776 |         const typeof(right) __right = (right);                                 \
      |                      ^~~~~
../include/kunit/test.h:971:9: note: in expansion of macro ‘KUNIT_BINARY_INT_ASSERTION’
  971 |         KUNIT_BINARY_INT_ASSERTION(test,                                       \
      |         ^~~~~~~~~~~~~~~~~~~~~~~~~~
../include/kunit/test.h:968:9: note: in expansion of macro ‘KUNIT_EXPECT_EQ_MSG’
  968 |         KUNIT_EXPECT_EQ_MSG(test, left, right, NULL)
      |         ^~~~~~~~~~~~~~~~~~~
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:89:9: note: in expansion of macro ‘KUNIT_EXPECT_EQ’
   89 |         KUNIT_EXPECT_EQ(test, result, GPIO_LINE_DIRECTION_OUT);
      |         ^~~~~~~~~~~~~~~
../drivers/pinctrl/amd_gpio_irq_mask_kunit_test.c: In function ‘test_amd_gpio_irq_mask_zero_offset’:
../drivers/pinctrl/amd_gpio_irq_mask_kunit_test.c:78:17: warning: assignment to ‘int’ from ‘char *’ makes integer from pointer without a cast [-Wint-conversion]
   78 |         gc.base = test_mmio_buffer;
      |                 ^
../drivers/pinctrl/amd_gpio_irq_mask_kunit_test.c:79:11: error: ‘struct gpio_chip’ has no member named ‘parent_data’
   79 |         gc.parent_data = NULL;
      |           ^
../drivers/pinctrl/amd_gpio_irq_mask_kunit_test.c:83:12: error: ‘struct gpio_chip’ has no member named ‘of_node’; did you mean ‘fwnode’?
   83 |         gc.of_node = NULL;
      |            ^~~~~~~
      |            fwnode
../drivers/pinctrl/amd_gpio_irq_mask_kunit_test.c:85:18: error: incompatible types when assigning to type ‘struct gpio_irq_chip’ from type ‘int’
   85 |         gc.irq = 0;
      |                  ^
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c: At top level:
../drivers/pinctrl/amd_gpio_irq_mask_kunit_test.c:86:11: error: ‘struct gpio_chip’ has no member named ‘irqchip’
   86 |         gc.irqchip = NULL;
      |           ^
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:9:24: error: storage size of ‘gpio_dev’ isn’t known
    9 | static struct amd_gpio gpio_dev;
      |                        ^~~~~~~~
../drivers/pinctrl/amd_gpio_irq_mask_kunit_test.c:87:11: error: ‘struct gpio_chip’ has no member named ‘irqdomain’
   87 |         gc.irqdomain = NULL;
      |           ^
../drivers/pinctrl/amd_gpio_irq_mask_kunit_test.c:104:17: error: invalid use of undefined type ‘struct amd_gpio’
  104 |         gpio_dev.base = gc.base;
      |                 ^
../drivers/pinctrl/amd_gpio_irq_mask_kunit_test.c:105:17: error: invalid use of undefined type ‘struct amd_gpio’
  105 |         gpio_dev.lock = __RAW_SPIN_LOCK_UNLOCKED(gpio_dev.lock);
      |                 ^
../drivers/pinctrl/amd_gpio_irq_mask_kunit_test.c:108:16: error: assignment to ‘struct irq_chip *’ from incompatible pointer type ‘struct gpio_chip *’ [-Werror=incompatible-pointer-types]
  108 |         d.chip = &gc;
      |                ^
../drivers/pinctrl/amd_gpio_irq_mask_kunit_test.c:110:36: error: invalid use of undefined type ‘struct amd_gpio’
  110 |         writel(0xFFFFFFFF, gpio_dev.base + hwirq * 4);
      |                                    ^
../drivers/pinctrl/amd_gpio_irq_mask_kunit_test.c:112:36: error: invalid use of undefined type ‘struct amd_gpio’
  112 |         u32 result = readl(gpio_dev.base + hwirq * 4);
      |                                    ^
../drivers/pinctrl/amd_gpio_irq_mask_kunit_test.c: In function ‘test_amd_gpio_irq_mask_max_offset’:
../drivers/pinctrl/amd_gpio_irq_mask_kunit_test.c:122:17: warning: assignment to ‘int’ from ‘char *’ makes integer from pointer without a cast [-Wint-conversion]
  122 |         gc.base = test_mmio_buffer;
      |                 ^
../drivers/pinctrl/amd_gpio_irq_mask_kunit_test.c:123:11: error: ‘struct gpio_chip’ has no member named ‘parent_data’
  123 |         gc.parent_data = NULL;
      |           ^
../drivers/pinctrl/amd_gpio_irq_mask_kunit_test.c:127:12: error: ‘struct gpio_chip’ has no member named ‘of_node’; did you mean ‘fwnode’?
  127 |         gc.of_node = NULL;
      |            ^~~~~~~
      |            fwnode
../drivers/pinctrl/amd_gpio_irq_mask_kunit_test.c:129:18: error: incompatible types when assigning to type ‘struct gpio_irq_chip’ from type ‘int’
  129 |         gc.irq = 0;
      |                  ^
../drivers/pinctrl/amd_gpio_irq_mask_kunit_test.c:130:11: error: ‘struct gpio_chip’ has no member named ‘irqchip’
  130 |         gc.irqchip = NULL;
      |           ^
../drivers/pinctrl/amd_gpio_irq_mask_kunit_test.c:131:11: error: ‘struct gpio_chip’ has no member named ‘irqdomain’
  131 |         gc.irqdomain = NULL;
      |           ^
../drivers/pinctrl/amd_gpio_irq_mask_kunit_test.c:148:17: error: invalid use of undefined type ‘struct amd_gpio’
  148 |         gpio_dev.base = gc.base;
      |                 ^
../drivers/pinctrl/amd_gpio_irq_mask_kunit_test.c:149:17: error: invalid use of undefined type ‘struct amd_gpio’
  149 |         gpio_dev.lock = __RAW_SPIN_LOCK_UNLOCKED(gpio_dev.lock);
      |                 ^
../drivers/pinctrl/amd_gpio_irq_mask_kunit_test.c:152:16: error: assignment to ‘struct irq_chip *’ from incompatible pointer type ‘struct gpio_chip *’ [-Werror=incompatible-pointer-types]
  152 |         d.chip = &gc;
      |                ^
../drivers/pinctrl/amd_gpio_irq_mask_kunit_test.c:154:36: error: invalid use of undefined type ‘struct amd_gpio’
  154 |         writel(0xFFFFFFFF, gpio_dev.base + hwirq * 4);
      |                                    ^
../drivers/pinctrl/amd_gpio_irq_mask_kunit_test.c:156:36: error: invalid use of undefined type ‘struct amd_gpio’
  156 |         u32 result = readl(gpio_dev.base + hwirq * 4);
      |                                    ^
../drivers/pinctrl/amd_gpio_irq_mask_kunit_test.c: At top level:
../drivers/pinctrl/amd_gpio_irq_mask_kunit_test.c:10:24: error: storage size of ‘gpio_dev’ isn’t known
   10 | static struct amd_gpio gpio_dev;
      |                        ^~~~~~~~
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c: In function ‘amd_gpio_get_direction’:
../drivers/pinctrl/amd_gpio_get_direction_kunit_test.c:26:1: error: control reaches end of non-void function [-Werror=return-type]
   26 | }
      | ^
cc1: some warnings being treated as errors
cc1: some warnings being treated as errors
make[5]: *** [../scripts/Makefile.build:287: drivers/pinctrl/amd_gpio_get_direction_kunit_test.o] Error 1
make[5]: *** Waiting for unfinished jobs....
make[5]: *** [../scripts/Makefile.build:287: drivers/pinctrl/amd_gpio_irq_mask_kunit_test.o] Error 1
make[4]: *** [../scripts/Makefile.build:554: drivers/pinctrl] Error 2
make[4]: *** Waiting for unfinished jobs....
make[3]: *** [../scripts/Makefile.build:554: drivers] Error 2
make[3]: *** Waiting for unfinished jobs....
make[2]: *** [/home/amd/linux/Makefile:2003: .] Error 2
make[1]: *** [/home/amd/linux/Makefile:248: __sub-make] Error 2
make: *** [Makefile:248: __sub-make] Error 2

[20:31:31] Configuring KUnit Kernel ...
[20:31:31] Building KUnit Kernel ...
Populating config with:
$ make ARCH=x86_64 O=.kunit olddefconfig
Building with:
$ make all compile_commands.json scripts_gdb ARCH=x86_64 O=.kunit --jobs=4
ERROR:root:make[5]: Warning: File 'drivers/pinctrl/.amd_pinconf_set_kunit_test.o.cmd' has modification time 7190 s in the future
In file included from ../include/linux/spinlock.h:314,
                 from ../include/linux/kref.h:16,
                 from ../include/kunit/test.h:22,
                 from ../drivers/pinctrl/amd_gpio_irq_mask_kunit_test.c:1:
../drivers/pinctrl/amd_gpio_irq_mask_kunit_test.c: In function ‘amd_gpio_irq_mask’:
../drivers/pinctrl/amd_gpio_irq_mask_kunit_test.c:21:40: error: invalid use of undefined type ‘struct amd_gpio’
   21 |         raw_spin_lock_irqsave(&gpio_dev->lock, flags);
      |                                        ^~
../include/linux/spinlock_api_up.h:28:32: note: in definition of macro ‘___LOCK’
   28 |   do { __acquire(lock); (void)(lock); } while (0)
      |                                ^~~~
../include/linux/spinlock_api_up.h:40:31: note: in expansion of macro ‘__LOCK’
   40 |   do { local_irq_save(flags); __LOCK(lock); } while (0)
      |                               ^~~~~~
../include/linux/spinlock_api_up.h:69:49: note: in expansion of macro ‘__LOCK_IRQSAVE’
   69 | #define _raw_spin_lock_irqsave(lock, flags)     __LOCK_IRQSAVE(lock, flags)
      |                                                 ^~~~~~~~~~~~~~
../include/linux/spinlock.h:266:17: note: in expansion of macro ‘_raw_spin_lock_irqsave’
  266 |                 _raw_spin_lock_irqsave(lock, flags);    \
      |                 ^~~~~~~~~~~~~~~~~~~~~~
../drivers/pinctrl/amd_gpio_irq_mask_kunit_test.c:21:9: note: in expansion of macro ‘raw_spin_lock_irqsave’
   21 |         raw_spin_lock_irqsave(&gpio_dev->lock, flags);
      |         ^~~~~~~~~~~~~~~~~~~~~
../drivers/pinctrl/amd_gpio_irq_mask_kunit_test.c:22:33: error: invalid use of undefined type ‘struct amd_gpio’
   22 |         pin_reg = readl(gpio_dev->base + hwirq * 4);
      |                                 ^~
../drivers/pinctrl/amd_gpio_irq_mask_kunit_test.c:24:33: error: invalid use of undefined type ‘struct amd_gpio’
   24 |         writel(pin_reg, gpio_dev->base + hwirq * 4);
      |                                 ^~
../drivers/pinctrl/amd_gpio_irq_mask_kunit_test.c:25:45: error: invalid use of undefined type ‘struct amd_gpio’
   25 |         raw_spin_unlock_irqrestore(&gpio_dev->lock, flags);
      |                                             ^~
../include/linux/spinlock_api_up.h:43:32: note: in definition of macro ‘___UNLOCK’
   43 |   do { __release(lock); (void)(lock); } while (0)
      |                                ^~~~
../include/linux/spinlock_api_up.h:56:34: note: in expansion of macro ‘__UNLOCK’
   56 |   do { local_irq_restore(flags); __UNLOCK(lock); } while (0)
      |                                  ^~~~~~~~
../include/linux/spinlock_api_up.h:86:41: note: in expansion of macro ‘__UNLOCK_IRQRESTORE’
   86 |                                         __UNLOCK_IRQRESTORE(lock, flags)
      |                                         ^~~~~~~~~~~~~~~~~~~
../include/linux/spinlock.h:282:17: note: in expansion of macro ‘_raw_spin_unlock_irqrestore’
  282 |                 _raw_spin_unlock_irqrestore(lock, flags);       \
      |                 ^~~~~~~~~~~~~~~~~~~~~~~~~~~
../drivers/pinctrl/amd_gpio_irq_mask_kunit_test.c:25:9: note: in expansion of macro ‘raw_spin_unlock_irqrestore’
   25 |         raw_spin_unlock_irqrestore(&gpio_dev->lock, flags);
      |         ^~~~~~~~~~~~~~~~~~~~~~~~~~
../drivers/pinctrl/amd_gpio_irq_mask_kunit_test.c: In function ‘test_amd_gpio_irq_mask_valid_offset’:
../drivers/pinctrl/amd_gpio_irq_mask_kunit_test.c:34:17: warning: assignment to ‘int’ from ‘char *’ makes integer from pointer without a cast [-Wint-conversion]
   34 |         gc.base = test_mmio_buffer;
      |                 ^
../drivers/pinctrl/amd_gpio_irq_mask_kunit_test.c:35:11: error: ‘struct gpio_chip’ has no member named ‘parent_data’
   35 |         gc.parent_data = NULL;
      |           ^
../drivers/pinctrl/amd_gpio_irq_mask_kunit_test.c:39:12: error: ‘struct gpio_chip’ has no member named ‘of_node’; did you mean ‘fwnode’?
   39 |         gc.of_node = NULL;
      |            ^~~~~~~
      |            fwnode
../drivers/pinctrl/amd_gpio_irq_mask_kunit_test.c:41:18: error: incompatible types when assigning to type ‘struct gpio_irq_chip’ from type ‘int’
   41 |         gc.irq = 0;
      |                  ^
../drivers/pinctrl/amd_gpio_irq_mask_kunit_test.c:42:11: error: ‘struct gpio_chip’ has no member named ‘irqchip’
   42 |         gc.irqchip = NULL;
      |           ^
../drivers/pinctrl/amd_gpio_irq_mask_kunit_test.c:43:11: error: ‘struct gpio_chip’ has no member named ‘irqdomain’
   43 |         gc.irqdomain = NULL;
      |           ^
../drivers/pinctrl/amd_gpio_irq_mask_kunit_test.c:60:17: error: invalid use of undefined type ‘struct amd_gpio’
   60 |         gpio_dev.base = gc.base;
      |                 ^
../drivers/pinctrl/amd_gpio_irq_mask_kunit_test.c:61:17: error: invalid use of undefined type ‘struct amd_gpio’
   61 |         gpio_dev.lock = __RAW_SPIN_LOCK_UNLOCKED(gpio_dev.lock);
      |                 ^
../drivers/pinctrl/amd_gpio_irq_mask_kunit_test.c:64:16: error: assignment to ‘struct irq_chip *’ from incompatible pointer type ‘struct gpio_chip *’ [-Werror=incompatible-pointer-types]
   64 |         d.chip = &gc;
      |                ^
../drivers/pinctrl/amd_gpio_irq_mask_kunit_test.c:66:36: error: invalid use of undefined type ‘struct amd_gpio’
   66 |         writel(0xFFFFFFFF, gpio_dev.base + hwirq * 4);
      |                                    ^
../drivers/pinctrl/amd_gpio_irq_mask_kunit_test.c:68:36: error: invalid use of undefined type ‘struct amd_gpio’
   68 |         u32 result = readl(gpio_dev.base + hwirq * 4);
      |                                    ^
../drivers/pinctrl/amd_gpio_irq_mask_kunit_test.c: In function ‘test_amd_gpio_irq_mask_zero_offset’:
../drivers/pinctrl/amd_gpio_irq_mask_kunit_test.c:78:17: warning: assignment to ‘int’ from ‘char *’ makes integer from pointer without a cast [-Wint-conversion]
   78 |         gc.base = test_mmio_buffer;
      |                 ^
../drivers/pinctrl/amd_gpio_irq_mask_kunit_test.c:79:11: error: ‘struct gpio_chip’ has no member named ‘parent_data’
   79 |         gc.parent_data = NULL;
      |           ^
../drivers/pinctrl/amd_gpio_irq_mask_kunit_test.c:83:12: error: ‘struct gpio_chip’ has no member named ‘of_node’; did you mean ‘fwnode’?
   83 |         gc.of_node = NULL;
      |            ^~~~~~~
      |            fwnode
../drivers/pinctrl/amd_gpio_irq_mask_kunit_test.c:85:18: error: incompatible types when assigning to type ‘struct gpio_irq_chip’ from type ‘int’
   85 |         gc.irq = 0;
      |                  ^
../drivers/pinctrl/amd_gpio_irq_mask_kunit_test.c:86:11: error: ‘struct gpio_chip’ has no member named ‘irqchip’
   86 |         gc.irqchip = NULL;
      |           ^
../drivers/pinctrl/amd_gpio_irq_mask_kunit_test.c:87:11: error: ‘struct gpio_chip’ has no member named ‘irqdomain’
   87 |         gc.irqdomain = NULL;
      |           ^
../drivers/pinctrl/amd_gpio_irq_mask_kunit_test.c:104:17: error: invalid use of undefined type ‘struct amd_gpio’
  104 |         gpio_dev.base = gc.base;
      |                 ^
../drivers/pinctrl/amd_gpio_irq_mask_kunit_test.c:105:17: error: invalid use of undefined type ‘struct amd_gpio’
  105 |         gpio_dev.lock = __RAW_SPIN_LOCK_UNLOCKED(gpio_dev.lock);
      |                 ^
../drivers/pinctrl/amd_gpio_irq_mask_kunit_test.c:108:16: error: assignment to ‘struct irq_chip *’ from incompatible pointer type ‘struct gpio_chip *’ [-Werror=incompatible-pointer-types]
  108 |         d.chip = &gc;
      |                ^
../drivers/pinctrl/amd_gpio_irq_mask_kunit_test.c:110:36: error: invalid use of undefined type ‘struct amd_gpio’
  110 |         writel(0xFFFFFFFF, gpio_dev.base + hwirq * 4);
      |                                    ^
../drivers/pinctrl/amd_gpio_irq_mask_kunit_test.c:112:36: error: invalid use of undefined type ‘struct amd_gpio’
  112 |         u32 result = readl(gpio_dev.base + hwirq * 4);
      |                                    ^
../drivers/pinctrl/amd_gpio_irq_mask_kunit_test.c: In function ‘test_amd_gpio_irq_mask_max_offset’:
../drivers/pinctrl/amd_gpio_irq_mask_kunit_test.c:122:17: warning: assignment to ‘int’ from ‘char *’ makes integer from pointer without a cast [-Wint-conversion]
  122 |         gc.base = test_mmio_buffer;
      |                 ^
../drivers/pinctrl/amd_gpio_irq_mask_kunit_test.c:123:11: error: ‘struct gpio_chip’ has no member named ‘parent_data’
  123 |         gc.parent_data = NULL;
      |           ^
../drivers/pinctrl/amd_gpio_irq_mask_kunit_test.c:127:12: error: ‘struct gpio_chip’ has no member named ‘of_node’; did you mean ‘fwnode’?
  127 |         gc.of_node = NULL;
      |            ^~~~~~~
      |            fwnode
../drivers/pinctrl/amd_gpio_irq_mask_kunit_test.c:129:18: error: incompatible types when assigning to type ‘struct gpio_irq_chip’ from type ‘int’
  129 |         gc.irq = 0;
      |                  ^
../drivers/pinctrl/amd_gpio_irq_mask_kunit_test.c:130:11: error: ‘struct gpio_chip’ has no member named ‘irqchip’
  130 |         gc.irqchip = NULL;
      |           ^
../drivers/pinctrl/amd_gpio_irq_mask_kunit_test.c:131:11: error: ‘struct gpio_chip’ has no member named ‘irqdomain’
  131 |         gc.irqdomain = NULL;
      |           ^
../drivers/pinctrl/amd_gpio_irq_mask_kunit_test.c:148:17: error: invalid use of undefined type ‘struct amd_gpio’
  148 |         gpio_dev.base = gc.base;
      |                 ^
../drivers/pinctrl/amd_gpio_irq_mask_kunit_test.c:149:17: error: invalid use of undefined type ‘struct amd_gpio’
  149 |         gpio_dev.lock = __RAW_SPIN_LOCK_UNLOCKED(gpio_dev.lock);
      |                 ^
../drivers/pinctrl/amd_gpio_irq_mask_kunit_test.c:152:16: error: assignment to ‘struct irq_chip *’ from incompatible pointer type ‘struct gpio_chip *’ [-Werror=incompatible-pointer-types]
  152 |         d.chip = &gc;
      |                ^
../drivers/pinctrl/amd_gpio_irq_mask_kunit_test.c:154:36: error: invalid use of undefined type ‘struct amd_gpio’
  154 |         writel(0xFFFFFFFF, gpio_dev.base + hwirq * 4);
      |                                    ^
../drivers/pinctrl/amd_gpio_irq_mask_kunit_test.c:156:36: error: invalid use of undefined type ‘struct amd_gpio’
  156 |         u32 result = readl(gpio_dev.base + hwirq * 4);
      |                                    ^
../drivers/pinctrl/amd_gpio_irq_mask_kunit_test.c: At top level:
../drivers/pinctrl/amd_gpio_irq_mask_kunit_test.c:10:24: error: storage size of ‘gpio_dev’ isn’t known
   10 | static struct amd_gpio gpio_dev;
      |                        ^~~~~~~~
cc1: some warnings being treated as errors
make[5]: *** [../scripts/Makefile.build:287: drivers/pinctrl/amd_gpio_irq_mask_kunit_test.o] Error 1
make[5]: *** Waiting for unfinished jobs....
../drivers/pinctrl/amd_gpio_irq_init_kunit_test.c: In function ‘amd_gpio_irq_init’:
../drivers/pinctrl/amd_gpio_irq_init_kunit_test.c:13:51: error: invalid use of undefined type ‘struct amd_gpio’
   13 |         const struct pinctrl_desc *desc = gpio_dev->pctrl->desc;
      |                                                   ^~
In file included from ../include/linux/bits.h:6,
                 from ../include/linux/ratelimit_types.h:5,
                 from ../include/linux/printk.h:9,
                 from ../include/kunit/assert.h:13,
                 from ../include/kunit/test.h:12,
                 from ../drivers/pinctrl/amd_gpio_irq_init_kunit_test.c:1:
../drivers/pinctrl/amd_gpio_irq_init_kunit_test.c:18:20: error: ‘WAKE_CNTRL_OFF_S0I3’ undeclared (first use in this function)
   18 |         mask = BIT(WAKE_CNTRL_OFF_S0I3) | BIT(WAKE_CNTRL_OFF_S3) |
      |                    ^~~~~~~~~~~~~~~~~~~
../include/vdso/bits.h:7:44: note: in definition of macro ‘BIT’
    7 | #define BIT(nr)                 (UL(1) << (nr))
      |                                            ^~
../drivers/pinctrl/amd_gpio_irq_init_kunit_test.c:18:20: note: each undeclared identifier is reported only once for each function it appears in
   18 |         mask = BIT(WAKE_CNTRL_OFF_S0I3) | BIT(WAKE_CNTRL_OFF_S3) |
      |                    ^~~~~~~~~~~~~~~~~~~
../include/vdso/bits.h:7:44: note: in definition of macro ‘BIT’
    7 | #define BIT(nr)                 (UL(1) << (nr))
      |                                            ^~
../drivers/pinctrl/amd_gpio_irq_init_kunit_test.c:18:47: error: ‘WAKE_CNTRL_OFF_S3’ undeclared (first use in this function)
   18 |         mask = BIT(WAKE_CNTRL_OFF_S0I3) | BIT(WAKE_CNTRL_OFF_S3) |
      |                                               ^~~~~~~~~~~~~~~~~
../include/vdso/bits.h:7:44: note: in definition of macro ‘BIT’
    7 | #define BIT(nr)                 (UL(1) << (nr))
      |                                            ^~
../drivers/pinctrl/amd_gpio_irq_init_kunit_test.c:19:21: error: ‘WAKE_CNTRL_OFF_S4’ undeclared (first use in this function)
   19 |                 BIT(WAKE_CNTRL_OFF_S4);
      |                     ^~~~~~~~~~~~~~~~~
../include/vdso/bits.h:7:44: note: in definition of macro ‘BIT’
    7 | #define BIT(nr)                 (UL(1) << (nr))
      |                                            ^~
../drivers/pinctrl/amd_gpio_irq_init_kunit_test.c:23:45: error: implicit declaration of function ‘pin_desc_get’ [-Werror=implicit-function-declaration]
   23 |                 const struct pin_desc *pd = pin_desc_get(gpio_dev->pctrl, pin);
      |                                             ^~~~~~~~~~~~
../drivers/pinctrl/amd_gpio_irq_init_kunit_test.c:23:66: error: invalid use of undefined type ‘struct amd_gpio’
   23 |                 const struct pin_desc *pd = pin_desc_get(gpio_dev->pctrl, pin);
      |                                                                  ^~
In file included from ../include/linux/spinlock.h:314,
                 from ../include/linux/kref.h:16,
                 from ../include/kunit/test.h:22:
../drivers/pinctrl/amd_gpio_irq_init_kunit_test.c:28:48: error: invalid use of undefined type ‘struct amd_gpio’
   28 |                 raw_spin_lock_irqsave(&gpio_dev->lock, flags);
      |                                                ^~
../include/linux/spinlock_api_up.h:31:27: note: in expansion of macro ‘___LOCK’
   31 |   do { preempt_disable(); ___LOCK(lock); } while (0)
      |                           ^~~~~~~
../include/linux/spinlock_api_up.h:40:31: note: in expansion of macro ‘__LOCK’
   40 |   do { local_irq_save(flags); __LOCK(lock); } while (0)
      |                               ^~~~~~
../include/linux/spinlock_api_up.h:69:49: note: in expansion of macro ‘__LOCK_IRQSAVE’
   69 | #define _raw_spin_lock_irqsave(lock, flags)     __LOCK_IRQSAVE(lock, flags)
      |                                                 ^~~~~~~~~~~~~~
../include/linux/spinlock.h:266:17: note: in expansion of macro ‘_raw_spin_lock_irqsave’
  266 |                 _raw_spin_lock_irqsave(lock, flags);    \
      |                 ^~~~~~~~~~~~~~~~~~~~~~
../drivers/pinctrl/amd_gpio_irq_init_kunit_test.c:28:17: note: in expansion of macro ‘raw_spin_lock_irqsave’
   28 |                 raw_spin_lock_irqsave(&gpio_dev->lock, flags);
      |                 ^~~~~~~~~~~~~~~~~~~~~
../drivers/pinctrl/amd_gpio_irq_init_kunit_test.c:30:41: error: invalid use of undefined type ‘struct amd_gpio’
   30 |                 pin_reg = readl(gpio_dev->base + pin * 4);
      |                                         ^~
../drivers/pinctrl/amd_gpio_irq_init_kunit_test.c:32:41: error: invalid use of undefined type ‘struct amd_gpio’
   32 |                 writel(pin_reg, gpio_dev->base + pin * 4);
      |                                         ^~
../drivers/pinctrl/amd_gpio_irq_init_kunit_test.c:34:53: error: invalid use of undefined type ‘struct amd_gpio’
   34 |                 raw_spin_unlock_irqrestore(&gpio_dev->lock, flags);
      |                                                     ^~
../include/linux/spinlock_api_up.h:43:32: note: in definition of macro ‘___UNLOCK’
   43 |   do { __release(lock); (void)(lock); } while (0)
      |                                ^~~~
../include/linux/spinlock_api_up.h:56:34: note: in expansion of macro ‘__UNLOCK’
   56 |   do { local_irq_restore(flags); __UNLOCK(lock); } while (0)
      |                                  ^~~~~~~~
../include/linux/spinlock_api_up.h:86:41: note: in expansion of macro ‘__UNLOCK_IRQRESTORE’
   86 |                                         __UNLOCK_IRQRESTORE(lock, flags)
      |                                         ^~~~~~~~~~~~~~~~~~~
../include/linux/spinlock.h:282:17: note: in expansion of macro ‘_raw_spin_unlock_irqrestore’
  282 |                 _raw_spin_unlock_irqrestore(lock, flags);       \
      |                 ^~~~~~~~~~~~~~~~~~~~~~~~~~~
../drivers/pinctrl/amd_gpio_irq_init_kunit_test.c:34:17: note: in expansion of macro ‘raw_spin_unlock_irqrestore’
   34 |                 raw_spin_unlock_irqrestore(&gpio_dev->lock, flags);
      |                 ^~~~~~~~~~~~~~~~~~~~~~~~~~
../drivers/pinctrl/amd_gpio_irq_init_kunit_test.c: At top level:
../drivers/pinctrl/amd_gpio_irq_init_kunit_test.c:38:30: error: array type has incomplete element type ‘struct pin_desc’
   38 | static const struct pin_desc mock_pins[] = {
      |                              ^~~~~~~~~
../drivers/pinctrl/amd_gpio_irq_init_kunit_test.c:48:15: error: variable ‘mock_pctrl_dev’ has initializer but incomplete type
   48 | static struct pinctrl_dev mock_pctrl_dev = {
      |               ^~~~~~~~~~~
../drivers/pinctrl/amd_gpio_irq_init_kunit_test.c:49:10: error: ‘struct pinctrl_dev’ has no member named ‘desc’
   49 |         .desc = &mock_desc,
      |          ^~~~
../drivers/pinctrl/amd_gpio_irq_init_kunit_test.c:49:17: warning: excess elements in struct initializer
   49 |         .desc = &mock_desc,
      |                 ^
../drivers/pinctrl/amd_gpio_irq_init_kunit_test.c:49:17: note: (near initialization for ‘mock_pctrl_dev’)
../drivers/pinctrl/amd_gpio_irq_init_kunit_test.c: In function ‘mock_pin_desc_get’:
../drivers/pinctrl/amd_gpio_irq_init_kunit_test.c:63:16: error: returning ‘const struct pinctrl_pin_desc *’ from a function with incompatible return type ‘struct pin_desc *’ [-Werror=incompatible-pointer-types]
   63 |         return &mock_desc.pins[pin];
      |                ^~~~~~~~~~~~~~~~~~~~
../drivers/pinctrl/amd_gpio_irq_init_kunit_test.c: In function ‘test_amd_gpio_irq_init_no_pins’:
../drivers/pinctrl/amd_gpio_irq_init_kunit_test.c:70:17: error: invalid use of undefined type ‘struct amd_gpio’
   70 |         gpio_dev.base = test_mmio_buffer;
      |                 ^
../drivers/pinctrl/amd_gpio_irq_init_kunit_test.c:71:17: error: invalid use of undefined type ‘struct amd_gpio’
   71 |         gpio_dev.pctrl = &mock_pctrl_dev;
      |                 ^
../drivers/pinctrl/amd_gpio_irq_init_kunit_test.c:72:25: error: assignment of member ‘npins’ in read-only object
   72 |         mock_desc.npins = 0;
      |                         ^
../drivers/pinctrl/amd_gpio_irq_init_kunit_test.c: In function ‘test_amd_gpio_irq_init_single_pin’:
../drivers/pinctrl/amd_gpio_irq_init_kunit_test.c:79:17: error: invalid use of undefined type ‘struct amd_gpio’
   79 |         gpio_dev.base = test_mmio_buffer;
      |                 ^
../drivers/pinctrl/amd_gpio_irq_init_kunit_test.c:80:17: error: invalid use of undefined type ‘struct amd_gpio’
   80 |         gpio_dev.pctrl = &mock_pctrl_dev;
      |                 ^
../drivers/pinctrl/amd_gpio_irq_init_kunit_test.c:81:25: error: assignment of member ‘npins’ in read-only object
   81 |         mock_desc.npins = 1;
      |                         ^
../drivers/pinctrl/amd_gpio_irq_init_kunit_test.c: In function ‘test_amd_gpio_irq_init_multiple_pins’:
../drivers/pinctrl/amd_gpio_irq_init_kunit_test.c:88:17: error: invalid use of undefined type ‘struct amd_gpio’
   88 |         gpio_dev.base = test_mmio_buffer;
      |                 ^
../drivers/pinctrl/amd_gpio_irq_init_kunit_test.c:89:17: error: invalid use of undefined type ‘struct amd_gpio’
   89 |         gpio_dev.pctrl = &mock_pctrl_dev;
      |                 ^
../drivers/pinctrl/amd_gpio_irq_init_kunit_test.c:90:25: error: assignment of member ‘npins’ in read-only object
   90 |         mock_desc.npins = 2;
      |                         ^
../drivers/pinctrl/amd_gpio_irq_init_kunit_test.c: In function ‘test_amd_gpio_irq_init_pin_desc_null’:
../drivers/pinctrl/amd_gpio_irq_init_kunit_test.c:97:17: error: invalid use of undefined type ‘struct amd_gpio’
   97 |         gpio_dev.base = test_mmio_buffer;
      |                 ^
../drivers/pinctrl/amd_gpio_irq_init_kunit_test.c:98:17: error: invalid use of undefined type ‘struct amd_gpio’
   98 |         gpio_dev.pctrl = &mock_pctrl_dev;
      |                 ^
../drivers/pinctrl/amd_gpio_irq_init_kunit_test.c:99:25: error: assignment of member ‘npins’ in read-only object
   99 |         mock_desc.npins = 1;
      |                         ^
../drivers/pinctrl/amd_gpio_irq_init_kunit_test.c: At top level:
../drivers/pinctrl/amd_gpio_irq_init_kunit_test.c:8:24: error: storage size of ‘gpio_dev’ isn’t known
    8 | static struct amd_gpio gpio_dev;
      |                        ^~~~~~~~
../drivers/pinctrl/amd_gpio_irq_init_kunit_test.c:48:27: error: storage size of ‘mock_pctrl_dev’ isn’t known
   48 | static struct pinctrl_dev mock_pctrl_dev = {
      |                           ^~~~~~~~~~~~~~
../drivers/pinctrl/amd_gpio_irq_init_kunit_test.c:59:25: warning: ‘mock_pin_desc_get’ defined but not used [-Wunused-function]
   59 | static struct pin_desc *mock_pin_desc_get(struct pinctrl_dev *pctldev, unsigned int pin)
      |                         ^~~~~~~~~~~~~~~~~
../drivers/pinctrl/amd_gpio_irq_init_kunit_test.c:52:14: warning: ‘mock_pinctrl_dev_get_drvdata’ defined but not used [-Wunused-function]
   52 | static void *mock_pinctrl_dev_get_drvdata(struct pinctrl_dev *pctldev)
      |              ^~~~~~~~~~~~~~~~~~~~~~~~~~~~
../drivers/pinctrl/amd_gpio_irq_init_kunit_test.c:38:30: warning: ‘mock_pins’ defined but not used [-Wunused-variable]
   38 | static const struct pin_desc mock_pins[] = {
      |                              ^~~~~~~~~
cc1: some warnings being treated as errors
make[5]: *** [../scripts/Makefile.build:287: drivers/pinctrl/amd_gpio_irq_init_kunit_test.o] Error 1
make[4]: *** [../scripts/Makefile.build:554: drivers/pinctrl] Error 2
make[4]: *** Waiting for unfinished jobs....
make[3]: *** [../scripts/Makefile.build:554: drivers] Error 2
make[3]: *** Waiting for unfinished jobs....
make[2]: *** [/home/amd/linux/Makefile:2003: .] Error 2
make[1]: *** [/home/amd/linux/Makefile:248: __sub-make] Error 2
make: *** [Makefile:248: __sub-make] Error 2

[20:32:07] Configuring KUnit Kernel ...
[20:32:07] Building KUnit Kernel ...
Populating config with:
$ make ARCH=x86_64 O=.kunit olddefconfig
Building with:
$ make all compile_commands.json scripts_gdb ARCH=x86_64 O=.kunit --jobs=4
